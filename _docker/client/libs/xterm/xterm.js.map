{
  "version": 3,
  "sources": [
    "node_modules/.npminstall/browser-pack/6.0.1/browser-pack/_prelude.js",
    "src\\CompositionHelper.js",
    "src\\EventEmitter.js",
    "src\\Viewport.js",
    "src\\src\\xterm.js"
  ],
  "names": [],
  "mappings": "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AAK,MAAlB,EACA,MAEF;AACA;AACA,IAAK,GAAL,CACE,KAAK,SAAL,CAAe,KAAK,MAApB,EACA,MAEF;AACA;AACA;AACA;AACA,IAAK,GAAL,CACE,KAAK,eAAL,CAAqB,KAAK,MAA1B,EACA,MAEF;AACA;AACA,IAAK,GAAL,CACE,KAAK,UAAL,CAAgB,KAAK,MAArB,EACA,MAEF;AACA;AACA,IAAK,GAAL,CACE,KAAK,aAAL,CAAmB,KAAK,MAAxB,EACA,MAEA;;eAIF;AACA;AACA,IAAK,GAAL,CACE,KAAK,gBAAL,CAAsB,KAAK,MAA3B,EACA,MAEF;AACA,IAAK,GAAL,CACE,KAAK,QAAL,CAAc,KAAK,MAAnB,EACA,MAEF;AACA;AACA;AACA,IAAK,GAAL,CACE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAI,KAAK,MAAL,CAAY,MAAZ,CAAqB,CAArB,EAA0B,CAAC,KAAK,MAApC,CAA4C,CAC1C,KAAK,UAAL,CAAgB,KAAK,MAArB,EACD,CACD,MAEF;AACA;AACA,IAAK,GAAL,CACE,KAAK,iBAAL,CAAuB,KAAK,MAA5B,EACA,MAEF;AACA,IAAK,GAAL,CACE,KAAK,wBAAL,CAA8B,KAAK,MAAnC,EACA,MAEF;AACA,IAAK,GAAL,CACE,KAAK,QAAL,CAAc,KAAK,MAAnB,EACA,MAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACF,IAAK,GAAL,CACE,OAAQ,KAAK,MAAb,EACI;AACA;AACA;AACF,IAAK,GAAL,CACE,KAAK,SAAL,CAAe,KAAK,MAApB,EACA,MACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlBJ,CAoBA,MAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEF,QACE,KAAK,KAAL,CAAW,uBAAX,CAAoC,EAApC,EACA,MApaJ,CAuaA,KAAK,MAAL,CAAc,EAAd,CACA,KAAK,OAAL,CAAe,EAAf,CACA,MAEF,IAAK,IAAL,CACE,GAAI,KAAO,MAAP,EAAiB,KAAO,MAA5B,CAAoC,CAClC,GAAI,KAAO,MAAX,CAAmB,IAEnB,OAAQ,KAAK,MAAb,EACE;AACA,IAAK,EAAL,CACE,MAEF;AACA;AACA,IAAK,IAAL,CACE,GAAI,IAAK,KAAK,YAAd,CACE,MAAQ,KADV,CAGA,OAAQ,EAAR,EACE;AACA,IAAK,IAAL,CACE,GAAK,KAAL,CACA,MAEF;AACA,IAAK,IAAL,CACE,GAAK,MAAL,CACA,MAEF;AACA,IAAK,GAAL,CACE,GAAK,IACA,KAAK,SAAL,CAAiB,CADjB,EAED,GAFC,EAGA,KAAK,YAAL,CAAoB,CAHpB,EAID,GAJJ,CAKA,MAEF;AACA,IAAK,GAAL,CACE,GAAK,IAAL,CACA,MAEF,QACE,KAAK,KAAL,CAAW,qBAAX,CAAkC,EAAlC,EACA,GAAK,EAAL,CACA,MA5BJ,CA+BA,KAAK,IAAL,CAAU,QAAU,EAAC,KAAX,CAAmB,IAAnB,CAA0B,EAA1B,CAA+B,QAAzC,EACA,MAEF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",
  "file": "generated.js",
  "sourceRoot": "",
  "sourcesContent": [
    "(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})",
    "/**\r\n * xterm.js: xterm, in the browser\r\n * Copyright (c) 2016, SourceLair Limited <www.sourcelair.com> (MIT License)\r\n */\r\n\r\n/**\r\n * Encapsulates the logic for handling compositionstart, compositionupdate and compositionend\r\n * events, displaying the in-progress composition to the UI and forwarding the final composition\r\n * to the handler.\r\n * @param {HTMLTextAreaElement} textarea The textarea that xterm uses for input.\r\n * @param {HTMLElement} compositionView The element to display the in-progress composition in.\r\n * @param {Terminal} terminal The Terminal to forward the finished composition to.\r\n */\r\nfunction CompositionHelper(textarea, compositionView, terminal) {\r\n  this.textarea = textarea;\r\n  this.compositionView = compositionView;\r\n  this.terminal = terminal;\r\n\r\n  // Whether input composition is currently happening, eg. via a mobile keyboard, speech input\r\n  // or IME. This variable determines whether the compositionText should be displayed on the UI.\r\n  this.isComposing = false;\r\n\r\n  // The input currently being composed, eg. via a mobile keyboard, speech input or IME.\r\n  this.compositionText = null;\r\n\r\n  // The position within the input textarea's value of the current composition.\r\n  this.compositionPosition = { start: null, end: null };\r\n\r\n  // Whether a composition is in the process of being sent, setting this to false will cancel\r\n  // any in-progress composition.\r\n  this.isSendingComposition = false;\r\n}\r\n\r\n/**\r\n * Handles the compositionstart event, activating the composition view.\r\n */\r\nCompositionHelper.prototype.compositionstart = function() {\r\n  this.isComposing = true;\r\n  this.compositionPosition.start = this.textarea.value.length;\r\n  this.compositionView.textContent = '';\r\n  this.compositionView.classList.add('active');\r\n};\r\n\r\n/**\r\n * Handles the compositionupdate event, updating the composition view.\r\n * @param {CompositionEvent} ev The event.\r\n */\r\nCompositionHelper.prototype.compositionupdate = function(ev) {\r\n  this.compositionView.textContent = ev.data;\r\n  this.updateCompositionElements();\r\n  var self = this;\r\n  setTimeout(function() {\r\n    self.compositionPosition.end = self.textarea.value.length;\r\n  }, 0);\r\n};\r\n\r\n/**\r\n * Handles the compositionend event, hiding the composition view and sending the composition to\r\n * the handler.\r\n */\r\nCompositionHelper.prototype.compositionend = function() {\r\n  this.finalizeComposition(true);\r\n};\r\n\r\n/**\r\n * Handles the keydown event, routing any necessary events to the CompositionHelper functions.\r\n * @return Whether the Terminal should continue processing the keydown event.\r\n */\r\nCompositionHelper.prototype.keydown = function(ev) {\r\n  if (this.isComposing || this.isSendingComposition) {\r\n    if (ev.keyCode === 229) {\r\n      // Continue composing if the keyCode is the \"composition character\"\r\n      return false;\r\n    } else if (ev.keyCode === 16 || ev.keyCode === 17 || ev.keyCode === 18) {\r\n      // Continue composing if the keyCode is a modifier key\r\n      return false;\r\n    } else {\r\n      // Finish composition immediately. This is mainly here for the case where enter is\r\n      // pressed and the handler needs to be triggered before the command is executed.\r\n      this.finalizeComposition(false);\r\n    }\r\n  }\r\n\r\n  if (ev.keyCode === 229) {\r\n    // If the \"composition character\" is used but gets to this point it means a non-composition\r\n    // character (eg. numbers and punctuation) was pressed when the IME was active.\r\n    this.handleAnyTextareaChanges();\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\n/**\r\n * Finalizes the composition, resuming regular input actions. This is called when a composition\r\n * is ending.\r\n * @param {boolean} waitForPropogation Whether to wait for events to propogate before sending\r\n *   the input. This should be false if a non-composition keystroke is entered before the\r\n *   compositionend event is triggered, such as enter, so that the composition is send before\r\n *   the command is executed.\r\n */\r\nCompositionHelper.prototype.finalizeComposition = function(waitForPropogation) {\r\n  this.compositionView.classList.remove('active');\r\n  this.isComposing = false;\r\n  this.clearTextareaPosition();\r\n\r\n  if (!waitForPropogation) {\r\n    // Cancel any delayed composition send requests and send the input immediately.\r\n    this.isSendingComposition = false;\r\n    var input = this.textarea.value.substring(this.compositionPosition.start, this.compositionPosition.end);\r\n    this.terminal.handler(input);\r\n  } else {\r\n    // Make a deep copy of the composition position here as a new compositionstart event may\r\n    // fire before the setTimeout executes.\r\n    var currentCompositionPosition = {\r\n      start: this.compositionPosition.start,\r\n      end: this.compositionPosition.end,\r\n    }\r\n\r\n    // Since composition* events happen before the changes take place in the textarea on most\r\n    // browsers, use a setTimeout with 0ms time to allow the native compositionend event to\r\n    // complete. This ensures the correct character is retrieved, this solution was used\r\n    // because:\r\n    // - The compositionend event's data property is unreliable, at least on Chromium\r\n    // - The last compositionupdate event's data property does not always accurately describe\r\n    //   the character, a counter example being Korean where an ending consonsant can move to\r\n    //   the following character if the following input is a vowel.\r\n    var self = this;\r\n    this.isSendingComposition = true;\r\n    setTimeout(function () {\r\n      // Ensure that the input has not already been sent\r\n      if (self.isSendingComposition) {\r\n        self.isSendingComposition = false;\r\n        var input;\r\n        if (self.isComposing) {\r\n          // Use the end position to get the string if a new composition has started.\r\n          input = self.textarea.value.substring(currentCompositionPosition.start, currentCompositionPosition.end);\r\n        } else {\r\n          // Don't use the end position here in order to pick up any characters after the\r\n          // composition has finished, for example when typing a non-composition character\r\n          // (eg. 2) after a composition character.\r\n          input = self.textarea.value.substring(currentCompositionPosition.start);\r\n        }\r\n        self.terminal.handler(input);\r\n      }\r\n    }, 0);\r\n  }\r\n};\r\n\r\n/**\r\n * Apply any changes made to the textarea after the current event chain is allowed to complete.\r\n * This should be called when not currently composing but a keydown event with the \"composition\r\n * character\" (229) is triggered, in order to allow non-composition text to be entered when an\r\n * IME is active.\r\n */\r\nCompositionHelper.prototype.handleAnyTextareaChanges = function() {\r\n  var oldValue = this.textarea.value;\r\n  var self = this;\r\n  setTimeout(function() {\r\n    // Ignore if a composition has started since the timeout\r\n    if (!self.isComposing) {\r\n      var newValue = self.textarea.value;\r\n      var diff = newValue.replace(oldValue, '');\r\n      if (diff.length > 0) {\r\n        self.terminal.handler(diff);\r\n      }\r\n    }\r\n  }, 0);\r\n};\r\n\r\n/**\r\n * Positions the composition view on top of the cursor and the textarea just below it (so the\r\n * IME helper dialog is positioned correctly).\r\n */\r\nCompositionHelper.prototype.updateCompositionElements = function(dontRecurse) {\r\n  if (!this.isComposing) {\r\n    return;\r\n  }\r\n  var cursor = this.terminal.element.querySelector('.terminal-cursor');\r\n  if (cursor) {\r\n    this.compositionView.style.left = cursor.offsetLeft + 'px';\r\n    this.compositionView.style.top = cursor.offsetTop + 'px';\r\n    var compositionViewBounds = this.compositionView.getBoundingClientRect();\r\n    this.textarea.style.left = cursor.offsetLeft + compositionViewBounds.width + 'px';\r\n    this.textarea.style.top = (cursor.offsetTop + cursor.offsetHeight) + 'px';\r\n  }\r\n  if (!dontRecurse) {\r\n    setTimeout(this.updateCompositionElements.bind(this, true), 0);\r\n  }\r\n};\r\n\r\n/**\r\n * Clears the textarea's position so that the cursor does not blink on IE.\r\n * @private\r\n */\r\nCompositionHelper.prototype.clearTextareaPosition = function() {\r\n  this.textarea.style.left = '';\r\n  this.textarea.style.top = '';\r\n};\r\n\r\nexport { CompositionHelper };\r\n",
    "/**\r\n * EventEmitter\r\n */\r\n\r\nfunction EventEmitter() {\r\n  this._events = this._events || {};\r\n}\r\n\r\nEventEmitter.prototype.addListener = function(type, listener) {\r\n  this._events[type] = this._events[type] || [];\r\n  this._events[type].push(listener);\r\n};\r\n\r\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\r\n\r\nEventEmitter.prototype.removeListener = function(type, listener) {\r\n  if (!this._events[type]) return;\r\n\r\n  var obj = this._events[type]\r\n  , i = obj.length;\r\n\r\n  while (i--) {\r\n    if (obj[i] === listener || obj[i].listener === listener) {\r\n      obj.splice(i, 1);\r\n      return;\r\n    }\r\n  }\r\n};\r\n\r\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\r\n\r\nEventEmitter.prototype.removeAllListeners = function(type) {\r\n  if (this._events[type]) delete this._events[type];\r\n};\r\n\r\nEventEmitter.prototype.once = function(type, listener) {\r\n  var self = this;\r\n  function on() {\r\n    var args = Array.prototype.slice.call(arguments);\r\n    this.removeListener(type, on);\r\n    return listener.apply(this, args);\r\n  }\r\n  on.listener = listener;\r\n  return this.on(type, on);\r\n};\r\n\r\nEventEmitter.prototype.emit = function(type) {\r\n  if (!this._events[type]) return;\r\n\r\n  var args = Array.prototype.slice.call(arguments, 1)\r\n  , obj = this._events[type]\r\n  , l = obj.length\r\n  , i = 0;\r\n\r\n  for (; i < l; i++) {\r\n    obj[i].apply(this, args);\r\n  }\r\n};\r\n\r\nEventEmitter.prototype.listeners = function(type) {\r\n  return this._events[type] = this._events[type] || [];\r\n};\r\n\r\nexport { EventEmitter };\r\n",
    "/**\r\n * xterm.js: xterm, in the browser\r\n * Copyright (c) 2016, SourceLair Limited <www.sourcelair.com> (MIT License)\r\n */\r\n\r\n/**\r\n * Represents the viewport of a terminal, the visible area within the larger buffer of output.\r\n * Logic for the virtual scroll bar is included in this object.\r\n * @param {Terminal} terminal The Terminal object.\r\n * @param {HTMLElement} viewportElement The DOM element acting as the viewport\r\n * @param {HTMLElement} charMeasureElement A DOM element used to measure the character size of\r\n *   the terminal.\r\n */\r\nfunction Viewport(terminal, viewportElement, scrollArea, charMeasureElement) {\r\n  this.terminal = terminal;\r\n  this.viewportElement = viewportElement;\r\n  this.scrollArea = scrollArea;\r\n  this.charMeasureElement = charMeasureElement;\r\n  this.currentRowHeight = 0;\r\n  this.lastRecordedBufferLength = 0;\r\n  this.lastRecordedViewportHeight = 0;\r\n\r\n  this.terminal.on('scroll', this.syncScrollArea.bind(this));\r\n  this.terminal.on('resize', this.syncScrollArea.bind(this));\r\n  this.viewportElement.addEventListener('scroll', this.onScroll.bind(this));\r\n\r\n  this.syncScrollArea();\r\n}\r\n\r\n/**\r\n * Refreshes row height, setting line-height, viewport height and scroll area height if\r\n * necessary.\r\n * @param {number|undefined} charSize A character size measurement bounding rect object, if it\r\n *   doesn't exist it will be created.\r\n */\r\nViewport.prototype.refresh = function(charSize) {\r\n  var size = charSize || this.charMeasureElement.getBoundingClientRect();\r\n  if (size.height > 0) {\r\n    var rowHeightChanged = size.height !== this.currentRowHeight;\r\n    if (rowHeightChanged) {\r\n      this.currentRowHeight = size.height;\r\n      this.viewportElement.style.lineHeight = size.height + 'px';\r\n      this.terminal.rowContainer.style.lineHeight = size.height + 'px';\r\n    }\r\n    var viewportHeightChanged = this.lastRecordedViewportHeight !== this.terminal.rows;\r\n    if (rowHeightChanged || viewportHeightChanged) {\r\n      this.lastRecordedViewportHeight = this.terminal.rows;\r\n      this.viewportElement.style.height = size.height * this.terminal.rows + 'px';\r\n    }\r\n    this.scrollArea.style.height = (size.height * this.lastRecordedBufferLength) + 'px';\r\n  }\r\n};\r\n\r\n/**\r\n * Updates dimensions and synchronizes the scroll area if necessary.\r\n */\r\nViewport.prototype.syncScrollArea = function() {\r\n  if (this.isApplicationMode) {\r\n    // Fix scroll bar in application mode\r\n    this.lastRecordedBufferLength = this.terminal.rows;\r\n    this.refresh();\r\n    return;\r\n  }\r\n\r\n  if (this.lastRecordedBufferLength !== this.terminal.lines.length) {\r\n    // If buffer height changed\r\n    this.lastRecordedBufferLength = this.terminal.lines.length;\r\n    this.refresh();\r\n  } else if (this.lastRecordedViewportHeight !== this.terminal.rows) {\r\n    // If viewport height changed\r\n    this.refresh();\r\n  } else {\r\n    // If size has changed, refresh viewport\r\n    var size = this.charMeasureElement.getBoundingClientRect();\r\n    if (size.height !== this.currentRowHeight) {\r\n      this.refresh(size);\r\n    }\r\n  }\r\n\r\n  // Sync scrollTop\r\n  var scrollTop = this.terminal.ydisp * this.currentRowHeight;\r\n  if (this.viewportElement.scrollTop !== scrollTop) {\r\n    this.viewportElement.scrollTop = scrollTop;\r\n  }\r\n};\r\n\r\n/**\r\n * Sets the application mode of the viewport.\r\n * @param {boolean} isApplicationMode Sets whether the terminal is in application mode. true\r\n * for application mode (DECKPAM) and false for normal mode (DECKPNM).\r\n */\r\nViewport.prototype.setApplicationMode = function(isApplicationMode) {\r\n  this.isApplicationMode = isApplicationMode;\r\n  this.syncScrollArea();\r\n};\r\n\r\n/**\r\n * Handles scroll events on the viewport, calculating the new viewport and requesting the\r\n * terminal to scroll to it.\r\n * @param {Event} ev The scroll event.\r\n */\r\nViewport.prototype.onScroll = function(ev) {\r\n  if (this.isApplicationMode) {\r\n    // Scrolling via the scroll bar is disabled during application mode\r\n    return;\r\n  }\r\n  var newRow = Math.round(this.viewportElement.scrollTop / this.currentRowHeight);\r\n  var diff = newRow - this.terminal.ydisp;\r\n  this.terminal.scrollDisp(diff, true);\r\n};\r\n\r\n/**\r\n * Handles mouse wheel events by adjusting the viewport's scrollTop and delegating the actual\r\n * scrolling to `onScroll`, this event needs to be attached manually by the consumer of\r\n * `Viewport`.\r\n * @param {WheelEvent} ev The mouse wheel event.\r\n */\r\nViewport.prototype.onWheel = function(ev) {\r\n  if (ev.deltaY === 0) {\r\n    // Do nothing if it's not a vertical scroll event\r\n    return;\r\n  }\r\n  // Fallback to WheelEvent.DOM_DELTA_PIXEL\r\n  var multiplier = 1;\r\n  if (ev.deltaMode === WheelEvent.DOM_DELTA_LINE) {\r\n    multiplier = this.currentRowHeight;\r\n  } else if (ev.deltaMode === WheelEvent.DOM_DELTA_PAGE) {\r\n    multiplier = this.currentRowHeight * this.terminal.rows;\r\n  }\r\n  this.viewportElement.scrollTop += ev.deltaY * multiplier;\r\n  // Prevent the page from scrolling when the terminal scrolls\r\n  ev.preventDefault();\r\n};\r\n\r\nexport { Viewport };\r\n",
    "/**\r\n * xterm.js: xterm, in the browser\r\n * Copyright (c) 2014, SourceLair Limited <www.sourcelair.com> (MIT License)\r\n * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)\r\n * https://github.com/chjj/term.js\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n * THE SOFTWARE.\r\n *\r\n * Originally forked from (with the author's permission):\r\n *   Fabrice Bellard's javascript vt100 for jslinux:\r\n *   http://bellard.org/jslinux/\r\n *   Copyright (c) 2011 Fabrice Bellard\r\n *   The original design remains. The terminal itself\r\n *   has been extended to include xterm CSI codes, among\r\n *   other features.\r\n */\r\n\r\nimport { CompositionHelper } from './CompositionHelper.js';\r\nimport { EventEmitter } from './EventEmitter.js';\r\nimport { Viewport } from './Viewport.js';\r\n\r\n/**\r\n * Terminal Emulation References:\r\n *   http://vt100.net/\r\n *   http://invisible-island.net/xterm/ctlseqs/ctlseqs.txt\r\n *   http://invisible-island.net/xterm/ctlseqs/ctlseqs.html\r\n *   http://invisible-island.net/vttest/\r\n *   http://www.inwap.com/pdp10/ansicode.txt\r\n *   http://linux.die.net/man/4/console_codes\r\n *   http://linux.die.net/man/7/urxvt\r\n */\r\n\r\n// Let it work inside Node.js for automated testing purposes.\r\nvar document = (typeof window != 'undefined') ? window.document : null;\r\n\r\n/**\r\n * States\r\n */\r\nvar normal = 0, escaped = 1, csi = 2, osc = 3, charset = 4, dcs = 5, ignore = 6;\r\n\r\n/**\r\n * Terminal\r\n */\r\n\r\n/**\r\n * Creates a new `Terminal` object.\r\n *\r\n * @param {object} options An object containing a set of options, the available options are:\r\n *   - cursorBlink (boolean): Whether the terminal cursor blinks\r\n *\r\n * @public\r\n * @class Xterm Xterm\r\n * @alias module:xterm/src/xterm\r\n */\r\nfunction Terminal(options) {\r\n  var self = this;\r\n\r\n  if (!(this instanceof Terminal)) {\r\n    return new Terminal(arguments[0], arguments[1], arguments[2]);\r\n  }\r\n\r\n  self.cancel = Terminal.cancel;\r\n\r\n  EventEmitter.call(this);\r\n\r\n  if (typeof options === 'number') {\r\n    options = {\r\n      cols: arguments[0],\r\n      rows: arguments[1],\r\n      handler: arguments[2]\r\n    };\r\n  }\r\n\r\n  options = options || {};\r\n\r\n\r\n  Object.keys(Terminal.defaults).forEach(function(key) {\r\n    if (options[key] == null) {\r\n      options[key] = Terminal.options[key];\r\n\r\n      if (Terminal[key] !== Terminal.defaults[key]) {\r\n        options[key] = Terminal[key];\r\n      }\r\n    }\r\n    self[key] = options[key];\r\n  });\r\n\r\n  if (options.colors.length === 8) {\r\n    options.colors = options.colors.concat(Terminal._colors.slice(8));\r\n  } else if (options.colors.length === 16) {\r\n    options.colors = options.colors.concat(Terminal._colors.slice(16));\r\n  } else if (options.colors.length === 10) {\r\n    options.colors = options.colors.slice(0, -2).concat(\r\n      Terminal._colors.slice(8, -2), options.colors.slice(-2));\r\n  } else if (options.colors.length === 18) {\r\n    options.colors = options.colors.concat(\r\n      Terminal._colors.slice(16, -2), options.colors.slice(-2));\r\n  }\r\n  this.colors = options.colors;\r\n\r\n  this.options = options;\r\n\r\n  // this.context = options.context || window;\r\n  // this.document = options.document || document;\r\n  this.parent = options.body || options.parent || (\r\n    document ? document.getElementsByTagName('body')[0] : null\r\n  );\r\n\r\n  this.cols = options.cols || options.geometry[0];\r\n  this.rows = options.rows || options.geometry[1];\r\n\r\n  if (options.handler) {\r\n    this.on('data', options.handler);\r\n  }\r\n\r\n  /**\r\n   * The scroll position of the y cursor, ie. ybase + y = the y position within the entire\r\n   * buffer\r\n   */\r\n  this.ybase = 0;\r\n\r\n  /**\r\n   * The scroll position of the viewport\r\n   */\r\n  this.ydisp = 0;\r\n\r\n  /**\r\n   * The cursor's x position after ybase\r\n   */\r\n  this.x = 0;\r\n\r\n  /**\r\n   * The cursor's y position after ybase\r\n   */\r\n  this.y = 0;\r\n\r\n  /**\r\n   * Used to debounce the refresh function\r\n   */\r\n  this.isRefreshing = false;\r\n\r\n  /**\r\n   * Whether there is a full terminal refresh queued\r\n   */\r\n\r\n  this.cursorState = 0;\r\n  this.cursorHidden = false;\r\n  this.convertEol;\r\n  this.state = 0;\r\n  this.queue = '';\r\n  this.scrollTop = 0;\r\n  this.scrollBottom = this.rows - 1;\r\n  this.customKeydownHandler = null;\r\n\r\n  // modes\r\n  this.applicationKeypad = false;\r\n  this.applicationCursor = false;\r\n  this.originMode = false;\r\n  this.insertMode = false;\r\n  this.wraparoundMode = true; // defaults: xterm - true, vt100 - false\r\n  this.normal = null;\r\n\r\n  // charset\r\n  this.charset = null;\r\n  this.gcharset = null;\r\n  this.glevel = 0;\r\n  this.charsets = [null];\r\n\r\n  // mouse properties\r\n  this.decLocator;\r\n  this.x10Mouse;\r\n  this.vt200Mouse;\r\n  this.vt300Mouse;\r\n  this.normalMouse;\r\n  this.mouseEvents;\r\n  this.sendFocus;\r\n  this.utfMouse;\r\n  this.sgrMouse;\r\n  this.urxvtMouse;\r\n\r\n  // misc\r\n  this.element;\r\n  this.children;\r\n  this.refreshStart;\r\n  this.refreshEnd;\r\n  this.savedX;\r\n  this.savedY;\r\n  this.savedCols;\r\n\r\n  // stream\r\n  this.readable = true;\r\n  this.writable = true;\r\n\r\n  this.defAttr = (0 << 18) | (257 << 9) | (256 << 0);\r\n  this.curAttr = this.defAttr;\r\n\r\n  this.params = [];\r\n  this.currentParam = 0;\r\n  this.prefix = '';\r\n  this.postfix = '';\r\n\r\n  // leftover surrogate high from previous write invocation\r\n  this.surrogate_high = '';\r\n\r\n  /**\r\n   * An array of all lines in the entire buffer, including the prompt. The lines are array of\r\n   * characters which are 2-length arrays where [0] is an attribute and [1] is the character.\r\n   */\r\n  this.lines = [];\r\n  var i = this.rows;\r\n  while (i--) {\r\n    this.lines.push(this.blankLine());\r\n  }\r\n\r\n  this.tabs;\r\n  this.setupStops();\r\n}\r\n\r\ninherits(Terminal, EventEmitter);\r\n\r\n/**\r\n * back_color_erase feature for xterm.\r\n */\r\nTerminal.prototype.eraseAttr = function() {\r\n  // if (this.is('screen')) return this.defAttr;\r\n  return (this.defAttr & ~0x1ff) | (this.curAttr & 0x1ff);\r\n};\r\n\r\n/**\r\n * Colors\r\n */\r\n\r\n// Colors 0-15\r\nTerminal.tangoColors = [\r\n  // dark:\r\n  '#2e3436',\r\n  '#cc0000',\r\n  '#4e9a06',\r\n  '#c4a000',\r\n  '#3465a4',\r\n  '#75507b',\r\n  '#06989a',\r\n  '#d3d7cf',\r\n  // bright:\r\n  '#555753',\r\n  '#ef2929',\r\n  '#8ae234',\r\n  '#fce94f',\r\n  '#729fcf',\r\n  '#ad7fa8',\r\n  '#34e2e2',\r\n  '#eeeeec'\r\n];\r\n\r\n// Colors 0-15 + 16-255\r\n// Much thanks to TooTallNate for writing this.\r\nTerminal.colors = (function() {\r\n  var colors = Terminal.tangoColors.slice()\r\n  , r = [0x00, 0x5f, 0x87, 0xaf, 0xd7, 0xff]\r\n  , i;\r\n\r\n  // 16-231\r\n  i = 0;\r\n  for (; i < 216; i++) {\r\n    out(r[(i / 36) % 6 | 0], r[(i / 6) % 6 | 0], r[i % 6]);\r\n  }\r\n\r\n  // 232-255 (grey)\r\n  i = 0;\r\n  for (; i < 24; i++) {\r\n    r = 8 + i * 10;\r\n    out(r, r, r);\r\n  }\r\n\r\n  function out(r, g, b) {\r\n    colors.push('#' + hex(r) + hex(g) + hex(b));\r\n  }\r\n\r\n  function hex(c) {\r\n    c = c.toString(16);\r\n    return c.length < 2 ? '0' + c : c;\r\n  }\r\n\r\n  return colors;\r\n})();\r\n\r\nTerminal._colors = Terminal.colors.slice();\r\n\r\nTerminal.vcolors = (function() {\r\n  var out = []\r\n  , colors = Terminal.colors\r\n  , i = 0\r\n  , color;\r\n\r\n  for (; i < 256; i++) {\r\n    color = parseInt(colors[i].substring(1), 16);\r\n    out.push([\r\n      (color >> 16) & 0xff,\r\n      (color >> 8) & 0xff,\r\n      color & 0xff\r\n    ]);\r\n  }\r\n\r\n  return out;\r\n})();\r\n\r\n/**\r\n * Options\r\n */\r\n\r\nTerminal.defaults = {\r\n  colors: Terminal.colors,\r\n  theme: 'default',\r\n  convertEol: false,\r\n  termName: 'xterm',\r\n  geometry: [80, 24],\r\n  cursorBlink: false,\r\n  visualBell: false,\r\n  popOnBell: false,\r\n  scrollback: 1000,\r\n  screenKeys: false,\r\n  debug: false,\r\n  cancelEvents: false\r\n  // programFeatures: false,\r\n  // focusKeys: false,\r\n};\r\n\r\nTerminal.options = {};\r\n\r\nTerminal.focus = null;\r\n\r\neach(keys(Terminal.defaults), function(key) {\r\n  Terminal[key] = Terminal.defaults[key];\r\n  Terminal.options[key] = Terminal.defaults[key];\r\n});\r\n\r\n/**\r\n * Focus the terminal. Delegates focus handling to the terminal's DOM element.\r\n */\r\nTerminal.prototype.focus = function() {\r\n  return this.textarea.focus();\r\n};\r\n\r\n/**\r\n * Sets an option on the terminal.\r\n * @param {string} key The option key.\r\n * @param {string} value The option value.\r\n */\r\nTerminal.prototype.setOption = function(key, value) {\r\n  if (!(key in Terminal.defaults)) {\r\n    throw new Error('No option with key \"' + key + '\"');\r\n  }\r\n  this[key] = value;\r\n  this.options[key] = value;\r\n};\r\n\r\n/**\r\n * Binds the desired focus behavior on a given terminal object.\r\n *\r\n * @static\r\n */\r\nTerminal.bindFocus = function (term) {\r\n  on(term.textarea, 'focus', function (ev) {\r\n    if (term.sendFocus) {\r\n      term.send('\\x1b[I');\r\n    }\r\n    term.element.classList.add('focus');\r\n    term.showCursor();\r\n    Terminal.focus = term;\r\n    term.emit('focus', {terminal: term});\r\n  });\r\n};\r\n\r\n/**\r\n * Blur the terminal. Delegates blur handling to the terminal's DOM element.\r\n */\r\nTerminal.prototype.blur = function() {\r\n  return this.textarea.blur();\r\n};\r\n\r\n/**\r\n * Binds the desired blur behavior on a given terminal object.\r\n *\r\n * @static\r\n */\r\nTerminal.bindBlur = function (term) {\r\n  on(term.textarea, 'blur', function (ev) {\r\n    term.refresh(term.y, term.y);\r\n    if (term.sendFocus) {\r\n      term.send('\\x1b[O');\r\n    }\r\n    term.element.classList.remove('focus');\r\n    Terminal.focus = null;\r\n    term.emit('blur', {terminal: term});\r\n  });\r\n};\r\n\r\n/**\r\n * Initialize default behavior\r\n */\r\nTerminal.prototype.initGlobal = function() {\r\n  Terminal.bindPaste(this);\r\n  Terminal.bindKeys(this);\r\n  Terminal.bindCopy(this);\r\n  Terminal.bindFocus(this);\r\n  Terminal.bindBlur(this);\r\n};\r\n\r\n/**\r\n * Bind to paste event and allow both keyboard and right-click pasting, without having the\r\n * contentEditable value set to true.\r\n */\r\nTerminal.bindPaste = function(term) {\r\n  on([term.textarea, term.element], 'paste', function(ev) {\r\n    ev.stopPropagation();\r\n    if (ev.clipboardData) {\r\n      var text = ev.clipboardData.getData('text/plain');\r\n      term.handler(text);\r\n      term.textarea.value = '';\r\n      return term.cancel(ev);\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * Prepares text copied from terminal selection, to be saved in the clipboard by:\r\n *   1. stripping all trailing white spaces\r\n *   2. converting all non-breaking spaces to regular spaces\r\n * @param {string} text The copied text that needs processing for storing in clipboard\r\n * @returns {string}\r\n * @static\r\n */\r\nTerminal.prepareCopiedTextForClipboard = function (text) {\r\n  var space = String.fromCharCode(32),\r\n      nonBreakingSpace = String.fromCharCode(160),\r\n      allNonBreakingSpaces = new RegExp(nonBreakingSpace, 'g'),\r\n      processedText = text.split('\\n').map(function (line) {\r\n        /**\r\n         * Strip all trailing white spaces and convert all non-breaking spaces to regular\r\n         * spaces.\r\n         */\r\n        var processedLine = line.replace(/\\s+$/g, '').replace(allNonBreakingSpaces, space);\r\n\r\n        return processedLine;\r\n      }).join('\\n');\r\n\r\n  return processedText;\r\n};\r\n\r\n/**\r\n * Apply key handling to the terminal\r\n */\r\nTerminal.bindKeys = function(term) {\r\n  on(term.element, 'keydown', function(ev) {\r\n    if (document.activeElement != this) {\r\n      return;\r\n    }\r\n    term.keyDown(ev);\r\n  }, true);\r\n\r\n  on(term.element, 'keypress', function(ev) {\r\n    if (document.activeElement != this) {\r\n      return;\r\n    }\r\n    term.keyPress(ev);\r\n  }, true);\r\n\r\n  on(term.element, 'keyup', term.focus.bind(term));\r\n\r\n  on(term.textarea, 'keydown', function(ev) {\r\n    term.keyDown(ev);\r\n  }, true);\r\n\r\n  on(term.textarea, 'keypress', function(ev) {\r\n    term.keyPress(ev);\r\n    // Truncate the textarea's value, since it is not needed\r\n    this.value = '';\r\n  }, true);\r\n\r\n  on(term.textarea, 'compositionstart', term.compositionHelper.compositionstart.bind(term.compositionHelper));\r\n  on(term.textarea, 'compositionupdate', term.compositionHelper.compositionupdate.bind(term.compositionHelper));\r\n  on(term.textarea, 'compositionend', term.compositionHelper.compositionend.bind(term.compositionHelper));\r\n  term.on('refresh', term.compositionHelper.updateCompositionElements.bind(term.compositionHelper));\r\n};\r\n\r\n/**\r\n * Binds copy functionality to the given terminal.\r\n * @static\r\n */\r\nTerminal.bindCopy = function(term) {\r\n  on(term.element, 'copy', function(ev) {\r\n    return; // temporary\r\n  });\r\n};\r\n\r\n\r\n/**\r\n * Insert the given row to the terminal or produce a new one\r\n * if no row argument is passed. Return the inserted row.\r\n * @param {HTMLElement} row (optional) The row to append to the terminal.\r\n */\r\nTerminal.prototype.insertRow = function (row) {\r\n  if (typeof row != 'object') {\r\n    row = document.createElement('div');\r\n  }\r\n\r\n  this.rowContainer.appendChild(row);\r\n  this.children.push(row);\r\n\r\n  return row;\r\n};\r\n\r\n/**\r\n * Opens the terminal within an element.\r\n *\r\n * @param {HTMLElement} parent The element to create the terminal within.\r\n */\r\nTerminal.prototype.open = function(parent) {\r\n  var self=this, i=0, div;\r\n\r\n  this.parent = parent || this.parent;\r\n\r\n  if (!this.parent) {\r\n    throw new Error('Terminal requires a parent element.');\r\n  }\r\n\r\n  // Grab global elements\r\n  this.context = this.parent.ownerDocument.defaultView;\r\n  this.document = this.parent.ownerDocument;\r\n  this.body = this.document.getElementsByTagName('body')[0];\r\n\r\n  // Parse User-Agent\r\n  if (this.context.navigator && this.context.navigator.userAgent) {\r\n    this.isMSIE = !!~this.context.navigator.userAgent.indexOf('MSIE');\r\n  }\r\n\r\n  // Find the users platform. We use this to interpret the meta key\r\n  // and ISO third level shifts.\r\n  // http://stackoverflow.com/q/19877924/577598\r\n  if (this.context.navigator && this.context.navigator.platform) {\r\n    this.isMac = contains(\r\n      this.context.navigator.platform,\r\n      ['Macintosh', 'MacIntel', 'MacPPC', 'Mac68K']\r\n    );\r\n    this.isIpad = this.context.navigator.platform === 'iPad';\r\n    this.isIphone = this.context.navigator.platform === 'iPhone';\r\n    this.isMSWindows = contains(\r\n      this.context.navigator.platform,\r\n      ['Windows', 'Win16', 'Win32', 'WinCE']\r\n    );\r\n  }\r\n\r\n  //Create main element container\r\n  this.element = this.document.createElement('div');\r\n  this.element.classList.add('terminal');\r\n  this.element.classList.add('xterm');\r\n  this.element.classList.add('xterm-theme-' + this.theme);\r\n\r\n  this.element.style.height\r\n  this.element.setAttribute('tabindex', 0);\r\n\r\n  this.viewportElement = document.createElement('div');\r\n  this.viewportElement.classList.add('xterm-viewport');\r\n  this.element.appendChild(this.viewportElement);\r\n  this.viewportScrollArea = document.createElement('div');\r\n  this.viewportScrollArea.classList.add('xterm-scroll-area');\r\n  this.viewportElement.appendChild(this.viewportScrollArea);\r\n\r\n  // Create the container that will hold the lines of the terminal and then\r\n  // produce the lines the lines.\r\n  this.rowContainer = document.createElement('div');\r\n  this.rowContainer.classList.add('xterm-rows');\r\n  this.element.appendChild(this.rowContainer);\r\n  this.children = [];\r\n\r\n  // Create the container that will hold helpers like the textarea for\r\n  // capturing DOM Events. Then produce the helpers.\r\n  this.helperContainer = document.createElement('div');\r\n  this.helperContainer.classList.add('xterm-helpers');\r\n  // TODO: This should probably be inserted once it's filled to prevent an additional layout\r\n  this.element.appendChild(this.helperContainer);\r\n  this.textarea = document.createElement('textarea');\r\n  this.textarea.classList.add('xterm-helper-textarea');\r\n  this.textarea.setAttribute('autocorrect', 'off');\r\n  this.textarea.setAttribute('autocapitalize', 'off');\r\n  this.textarea.setAttribute('spellcheck', 'false');\r\n  this.textarea.tabIndex = 0;\r\n  this.textarea.addEventListener('focus', function() {\r\n    self.emit('focus', {terminal: self});\r\n  });\r\n  this.textarea.addEventListener('blur', function() {\r\n    self.emit('blur', {terminal: self});\r\n  });\r\n  this.helperContainer.appendChild(this.textarea);\r\n\r\n  this.compositionView = document.createElement('div');\r\n  this.compositionView.classList.add('composition-view');\r\n  this.compositionHelper = new CompositionHelper(this.textarea, this.compositionView, this);\r\n  this.helperContainer.appendChild(this.compositionView);\r\n\r\n  this.charMeasureElement = document.createElement('div');\r\n  this.charMeasureElement.classList.add('xterm-char-measure-element');\r\n  this.charMeasureElement.innerHTML = 'W';\r\n  this.helperContainer.appendChild(this.charMeasureElement);\r\n\r\n  for (; i < this.rows; i++) {\r\n    this.insertRow();\r\n  }\r\n  this.parent.appendChild(this.element);\r\n\r\n  this.viewport = new Viewport(this, this.viewportElement, this.viewportScrollArea, this.charMeasureElement);\r\n\r\n  // Draw the screen.\r\n  this.refresh(0, this.rows - 1);\r\n\r\n  // Initialize global actions that\r\n  // need to be taken on the document.\r\n  this.initGlobal();\r\n\r\n  // Ensure there is a Terminal.focus.\r\n  this.focus();\r\n\r\n  on(this.element, 'click', function() {\r\n    var selection = document.getSelection(),\r\n        collapsed = selection.isCollapsed,\r\n        isRange = typeof collapsed == 'boolean' ? !collapsed : selection.type == 'Range';\r\n    if (!isRange) {\r\n      self.focus();\r\n    }\r\n  });\r\n\r\n  // Listen for mouse events and translate\r\n  // them into terminal mouse protocols.\r\n  this.bindMouse();\r\n\r\n  // Figure out whether boldness affects\r\n  // the character width of monospace fonts.\r\n  if (Terminal.brokenBold == null) {\r\n    Terminal.brokenBold = isBoldBroken(this.document);\r\n  }\r\n\r\n  this.emit('open');\r\n};\r\n\r\n\r\n/**\r\n * Attempts to load an add-on using CommonJS or RequireJS (whichever is available).\r\n * @param {string} addon The name of the addon to load\r\n * @static\r\n */\r\nTerminal.loadAddon = function(addon, callback) {\r\n  if (typeof exports === 'object' && typeof module === 'object') {\r\n    // CommonJS\r\n    return require(__dirname + '/../addons/' + addon);\r\n  } else if (typeof define == 'function') {\r\n    // RequireJS\r\n    return require(['../addons/' + addon + '/' + addon], callback);\r\n  } else {\r\n    console.error('Cannot load a module without a CommonJS or RequireJS environment.');\r\n    return false;\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * XTerm mouse events\r\n * http://invisible-island.net/xterm/ctlseqs/ctlseqs.html#Mouse%20Tracking\r\n * To better understand these\r\n * the xterm code is very helpful:\r\n * Relevant files:\r\n *   button.c, charproc.c, misc.c\r\n * Relevant functions in xterm/button.c:\r\n *   BtnCode, EmitButtonCode, EditorButton, SendMousePosition\r\n */\r\nTerminal.prototype.bindMouse = function() {\r\n  var el = this.element, self = this, pressed = 32;\r\n\r\n  // mouseup, mousedown, wheel\r\n  // left click: ^[[M 3<^[[M#3<\r\n  // wheel up: ^[[M`3>\r\n  function sendButton(ev) {\r\n    var button\r\n    , pos;\r\n\r\n    // get the xterm-style button\r\n    button = getButton(ev);\r\n\r\n    // get mouse coordinates\r\n    pos = getCoords(ev);\r\n    if (!pos) return;\r\n\r\n    sendEvent(button, pos);\r\n\r\n    switch (ev.overrideType || ev.type) {\r\n      case 'mousedown':\r\n        pressed = button;\r\n        break;\r\n      case 'mouseup':\r\n        // keep it at the left\r\n        // button, just in case.\r\n        pressed = 32;\r\n        break;\r\n      case 'wheel':\r\n        // nothing. don't\r\n        // interfere with\r\n        // `pressed`.\r\n        break;\r\n    }\r\n  }\r\n\r\n  // motion example of a left click:\r\n  // ^[[M 3<^[[M@4<^[[M@5<^[[M@6<^[[M@7<^[[M#7<\r\n  function sendMove(ev) {\r\n    var button = pressed\r\n    , pos;\r\n\r\n    pos = getCoords(ev);\r\n    if (!pos) return;\r\n\r\n    // buttons marked as motions\r\n    // are incremented by 32\r\n    button += 32;\r\n\r\n    sendEvent(button, pos);\r\n  }\r\n\r\n  // encode button and\r\n  // position to characters\r\n  function encode(data, ch) {\r\n    if (!self.utfMouse) {\r\n      if (ch === 255) return data.push(0);\r\n      if (ch > 127) ch = 127;\r\n      data.push(ch);\r\n    } else {\r\n      if (ch === 2047) return data.push(0);\r\n      if (ch < 127) {\r\n        data.push(ch);\r\n      } else {\r\n        if (ch > 2047) ch = 2047;\r\n        data.push(0xC0 | (ch >> 6));\r\n        data.push(0x80 | (ch & 0x3F));\r\n      }\r\n    }\r\n  }\r\n\r\n  // send a mouse event:\r\n  // regular/utf8: ^[[M Cb Cx Cy\r\n  // urxvt: ^[[ Cb ; Cx ; Cy M\r\n  // sgr: ^[[ Cb ; Cx ; Cy M/m\r\n  // vt300: ^[[ 24(1/3/5)~ [ Cx , Cy ] \\r\r\n  // locator: CSI P e ; P b ; P r ; P c ; P p & w\r\n  function sendEvent(button, pos) {\r\n    // self.emit('mouse', {\r\n    //   x: pos.x - 32,\r\n    //   y: pos.x - 32,\r\n    //   button: button\r\n    // });\r\n\r\n    if (self.vt300Mouse) {\r\n      // NOTE: Unstable.\r\n      // http://www.vt100.net/docs/vt3xx-gp/chapter15.html\r\n      button &= 3;\r\n      pos.x -= 32;\r\n      pos.y -= 32;\r\n      var data = '\\x1b[24';\r\n      if (button === 0) data += '1';\r\n      else if (button === 1) data += '3';\r\n      else if (button === 2) data += '5';\r\n      else if (button === 3) return;\r\n      else data += '0';\r\n      data += '~[' + pos.x + ',' + pos.y + ']\\r';\r\n      self.send(data);\r\n      return;\r\n    }\r\n\r\n    if (self.decLocator) {\r\n      // NOTE: Unstable.\r\n      button &= 3;\r\n      pos.x -= 32;\r\n      pos.y -= 32;\r\n      if (button === 0) button = 2;\r\n      else if (button === 1) button = 4;\r\n      else if (button === 2) button = 6;\r\n      else if (button === 3) button = 3;\r\n      self.send('\\x1b['\r\n                + button\r\n                + ';'\r\n                + (button === 3 ? 4 : 0)\r\n                + ';'\r\n                + pos.y\r\n                + ';'\r\n                + pos.x\r\n                + ';'\r\n                + (pos.page || 0)\r\n                + '&w');\r\n      return;\r\n    }\r\n\r\n    if (self.urxvtMouse) {\r\n      pos.x -= 32;\r\n      pos.y -= 32;\r\n      pos.x++;\r\n      pos.y++;\r\n      self.send('\\x1b[' + button + ';' + pos.x + ';' + pos.y + 'M');\r\n      return;\r\n    }\r\n\r\n    if (self.sgrMouse) {\r\n      pos.x -= 32;\r\n      pos.y -= 32;\r\n      self.send('\\x1b[<'\r\n                + ((button & 3) === 3 ? button & ~3 : button)\r\n                + ';'\r\n                + pos.x\r\n                + ';'\r\n                + pos.y\r\n                + ((button & 3) === 3 ? 'm' : 'M'));\r\n      return;\r\n    }\r\n\r\n    var data = [];\r\n\r\n    encode(data, button);\r\n    encode(data, pos.x);\r\n    encode(data, pos.y);\r\n\r\n    self.send('\\x1b[M' + String.fromCharCode.apply(String, data));\r\n  }\r\n\r\n  function getButton(ev) {\r\n    var button\r\n    , shift\r\n    , meta\r\n    , ctrl\r\n    , mod;\r\n\r\n    // two low bits:\r\n    // 0 = left\r\n    // 1 = middle\r\n    // 2 = right\r\n    // 3 = release\r\n    // wheel up/down:\r\n    // 1, and 2 - with 64 added\r\n    switch (ev.overrideType || ev.type) {\r\n      case 'mousedown':\r\n        button = ev.button != null\r\n          ? +ev.button\r\n        : ev.which != null\r\n          ? ev.which - 1\r\n        : null;\r\n\r\n        if (self.isMSIE) {\r\n          button = button === 1 ? 0 : button === 4 ? 1 : button;\r\n        }\r\n        break;\r\n      case 'mouseup':\r\n        button = 3;\r\n        break;\r\n      case 'DOMMouseScroll':\r\n        button = ev.detail < 0\r\n          ? 64\r\n        : 65;\r\n        break;\r\n      case 'wheel':\r\n        button = ev.wheelDeltaY > 0\r\n          ? 64\r\n        : 65;\r\n        break;\r\n    }\r\n\r\n    // next three bits are the modifiers:\r\n    // 4 = shift, 8 = meta, 16 = control\r\n    shift = ev.shiftKey ? 4 : 0;\r\n    meta = ev.metaKey ? 8 : 0;\r\n    ctrl = ev.ctrlKey ? 16 : 0;\r\n    mod = shift | meta | ctrl;\r\n\r\n    // no mods\r\n    if (self.vt200Mouse) {\r\n      // ctrl only\r\n      mod &= ctrl;\r\n    } else if (!self.normalMouse) {\r\n      mod = 0;\r\n    }\r\n\r\n    // increment to SP\r\n    button = (32 + (mod << 2)) + button;\r\n\r\n    return button;\r\n  }\r\n\r\n  // mouse coordinates measured in cols/rows\r\n  function getCoords(ev) {\r\n    var x, y, w, h, el;\r\n\r\n    // ignore browsers without pageX for now\r\n    if (ev.pageX == null) return;\r\n\r\n    x = ev.pageX;\r\n    y = ev.pageY;\r\n    el = self.element;\r\n\r\n    // should probably check offsetParent\r\n    // but this is more portable\r\n    while (el && el !== self.document.documentElement) {\r\n      x -= el.offsetLeft;\r\n      y -= el.offsetTop;\r\n      el = 'offsetParent' in el\r\n        ? el.offsetParent\r\n      : el.parentNode;\r\n    }\r\n\r\n    // convert to cols/rows\r\n    w = self.element.clientWidth;\r\n    h = self.element.clientHeight;\r\n    x = Math.ceil((x / w) * self.cols);\r\n    y = Math.ceil((y / h) * self.rows);\r\n\r\n    // be sure to avoid sending\r\n    // bad positions to the program\r\n    if (x < 0) x = 0;\r\n    if (x > self.cols) x = self.cols;\r\n    if (y < 0) y = 0;\r\n    if (y > self.rows) y = self.rows;\r\n\r\n    // xterm sends raw bytes and\r\n    // starts at 32 (SP) for each.\r\n    x += 32;\r\n    y += 32;\r\n\r\n    return {\r\n      x: x,\r\n      y: y,\r\n      type: 'wheel'\r\n    };\r\n  }\r\n\r\n  on(el, 'mousedown', function(ev) {\r\n    if (!self.mouseEvents) return;\r\n\r\n    // send the button\r\n    sendButton(ev);\r\n\r\n    // ensure focus\r\n    self.focus();\r\n\r\n    // fix for odd bug\r\n    //if (self.vt200Mouse && !self.normalMouse) {\r\n    if (self.vt200Mouse) {\r\n      ev.overrideType = 'mouseup';\r\n      sendButton(ev);\r\n      return self.cancel(ev);\r\n    }\r\n\r\n    // bind events\r\n    if (self.normalMouse) on(self.document, 'mousemove', sendMove);\r\n\r\n    // x10 compatibility mode can't send button releases\r\n    if (!self.x10Mouse) {\r\n      on(self.document, 'mouseup', function up(ev) {\r\n        sendButton(ev);\r\n        if (self.normalMouse) off(self.document, 'mousemove', sendMove);\r\n        off(self.document, 'mouseup', up);\r\n        return self.cancel(ev);\r\n      });\r\n    }\r\n\r\n    return self.cancel(ev);\r\n  });\r\n\r\n  //if (self.normalMouse) {\r\n  //  on(self.document, 'mousemove', sendMove);\r\n  //}\r\n\r\n  on(el, 'wheel', function(ev) {\r\n    if (!self.mouseEvents) return;\r\n    if (self.x10Mouse\r\n        || self.vt300Mouse\r\n        || self.decLocator) return;\r\n    sendButton(ev);\r\n    return self.cancel(ev);\r\n  });\r\n\r\n  // allow wheel scrolling in\r\n  // the shell for example\r\n  on(el, 'wheel', function(ev) {\r\n    if (self.mouseEvents) return;\r\n    if (self.applicationKeypad) return;\r\n    self.viewport.onWheel(ev);\r\n    return self.cancel(ev);\r\n  });\r\n};\r\n\r\n/**\r\n * Destroys the terminal.\r\n */\r\nTerminal.prototype.destroy = function() {\r\n  this.readable = false;\r\n  this.writable = false;\r\n  this._events = {};\r\n  this.handler = function() {};\r\n  this.write = function() {};\r\n  if (this.element.parentNode) {\r\n    this.element.parentNode.removeChild(this.element);\r\n  }\r\n  //this.emit('close');\r\n};\r\n\r\n\r\n/**\r\n * Flags used to render terminal text properly\r\n */\r\nTerminal.flags = {\r\n  BOLD: 1,\r\n  UNDERLINE: 2,\r\n  BLINK: 4,\r\n  INVERSE: 8,\r\n  INVISIBLE: 16\r\n}\r\n\r\n/**\r\n * Refreshes (re-renders) terminal content within two rows (inclusive)\r\n *\r\n * Rendering Engine:\r\n *\r\n * In the screen buffer, each character is stored as a an array with a character\r\n * and a 32-bit integer:\r\n *   - First value: a utf-16 character.\r\n *   - Second value:\r\n *   - Next 9 bits: background color (0-511).\r\n *   - Next 9 bits: foreground color (0-511).\r\n *   - Next 14 bits: a mask for misc. flags:\r\n *     - 1=bold\r\n *     - 2=underline\r\n *     - 4=blink\r\n *     - 8=inverse\r\n *     - 16=invisible\r\n *\r\n * @param {number} start The row to start from (between 0 and terminal's height terminal - 1)\r\n * @param {number} end The row to end at (between fromRow and terminal's height terminal - 1)\r\n * @param {boolean} queue Whether the refresh should ran right now or be queued\r\n */\r\nTerminal.prototype.refresh = function(start, end, queue) {\r\n  var self = this;\r\n\r\n  // queue defaults to true\r\n  queue = (typeof queue == 'undefined') ? true : queue;\r\n\r\n  /**\r\n   * The refresh queue allows refresh to execute only approximately 30 times a second. For\r\n   * commands that pass a significant amount of output to the write function, this prevents the\r\n   * terminal from maxing out the CPU and making the UI unresponsive. While commands can still\r\n   * run beyond what they do on the terminal, it is far better with a debounce in place as\r\n   * every single terminal manipulation does not need to be constructed in the DOM.\r\n   *\r\n   * A side-effect of this is that it makes ^C to interrupt a process seem more responsive.\r\n   */\r\n  if (queue) {\r\n    // If refresh should be queued, order the refresh and return.\r\n    if (this._refreshIsQueued) {\r\n      // If a refresh has already been queued, just order a full refresh next\r\n      this._fullRefreshNext = true;\r\n    } else {\r\n      setTimeout(function () {\r\n        self.refresh(start, end, false);\r\n      }, 34)\r\n      this._refreshIsQueued = true;\r\n    }\r\n    return;\r\n  }\r\n\r\n  // If refresh should be run right now (not be queued), release the lock\r\n  this._refreshIsQueued = false;\r\n\r\n  // If multiple refreshes were requested, make a full refresh.\r\n  if (this._fullRefreshNext) {\r\n    start = 0;\r\n    end = this.rows - 1;\r\n    this._fullRefreshNext = false // reset lock\r\n  }\r\n\r\n  var x, y, i, line, out, ch, ch_width, width, data, attr, bg, fg, flags, row, parent, focused = document.activeElement;\r\n\r\n  // If this is a big refresh, remove the terminal rows from the DOM for faster calculations\r\n  if (end - start >= this.rows / 2) {\r\n    parent = this.element.parentNode;\r\n    if (parent) {\r\n      this.element.removeChild(this.rowContainer);\r\n    }\r\n  }\r\n\r\n  width = this.cols;\r\n  y = start;\r\n\r\n  if (end >= this.rows.length) {\r\n    this.log('`end` is too large. Most likely a bad CSR.');\r\n    end = this.rows.length - 1;\r\n  }\r\n\r\n  for (; y <= end; y++) {\r\n    row = y + this.ydisp;\r\n\r\n    line = this.lines[row];\r\n    out = '';\r\n\r\n    if (this.y === y - (this.ybase - this.ydisp)\r\n        && this.cursorState\r\n        && !this.cursorHidden) {\r\n      x = this.x;\r\n    } else {\r\n      x = -1;\r\n    }\r\n\r\n    attr = this.defAttr;\r\n    i = 0;\r\n\r\n    for (; i < width; i++) {\r\n      data = line[i][0];\r\n      ch = line[i][1];\r\n      ch_width = line[i][2];\r\n      if (!ch_width)\r\n        continue;\r\n\r\n      if (i === x) data = -1;\r\n\r\n      if (data !== attr) {\r\n        if (attr !== this.defAttr) {\r\n          out += '</span>';\r\n        }\r\n        if (data !== this.defAttr) {\r\n          if (data === -1) {\r\n            out += '<span class=\"reverse-video terminal-cursor';\r\n            if (this.cursorBlink) {\r\n              out += ' blinking';\r\n            }\r\n            out += '\">';\r\n          } else {\r\n            var classNames = [];\r\n\r\n            bg = data & 0x1ff;\r\n            fg = (data >> 9) & 0x1ff;\r\n            flags = data >> 18;\r\n\r\n            if (flags & Terminal.flags.BOLD) {\r\n              if (!Terminal.brokenBold) {\r\n                classNames.push('xterm-bold');\r\n              }\r\n              // See: XTerm*boldColors\r\n              if (fg < 8) fg += 8;\r\n            }\r\n\r\n            if (flags & Terminal.flags.UNDERLINE) {\r\n              classNames.push('xterm-underline');\r\n            }\r\n\r\n            if (flags & Terminal.flags.BLINK) {\r\n              classNames.push('xterm-blink');\r\n            }\r\n\r\n            // If inverse flag is on, then swap the foreground and background variables.\r\n            if (flags & Terminal.flags.INVERSE) {\r\n              /* One-line variable swap in JavaScript: http://stackoverflow.com/a/16201730 */\r\n              bg = [fg, fg = bg][0];\r\n              // Should inverse just be before the\r\n              // above boldColors effect instead?\r\n              if ((flags & 1) && fg < 8) fg += 8;\r\n            }\r\n\r\n            if (flags & Terminal.flags.INVISIBLE) {\r\n              classNames.push('xterm-hidden');\r\n            }\r\n\r\n            /**\r\n             * Weird situation: Invert flag used black foreground and white background results\r\n             * in invalid background color, positioned at the 256 index of the 256 terminal\r\n             * color map. Pin the colors manually in such a case.\r\n             *\r\n             * Source: https://github.com/sourcelair/xterm.js/issues/57\r\n             */\r\n            if (flags & Terminal.flags.INVERSE) {\r\n              if (bg == 257) {\r\n                bg = 15;\r\n              }\r\n              if (fg == 256) {\r\n                fg = 0;\r\n              }\r\n            }\r\n\r\n            if (bg < 256) {\r\n              classNames.push('xterm-bg-color-' + bg);\r\n            }\r\n\r\n            if (fg < 256) {\r\n              classNames.push('xterm-color-' + fg);\r\n            }\r\n\r\n            out += '<span';\r\n            if (classNames.length) {\r\n              out += ' class=\"' + classNames.join(' ') + '\"';\r\n            }\r\n            out += '>';\r\n          }\r\n        }\r\n      }\r\n\r\n      switch (ch) {\r\n        case '&':\r\n          out += '&amp;';\r\n          break;\r\n        case '<':\r\n          out += '&lt;';\r\n          break;\r\n        case '>':\r\n          out += '&gt;';\r\n          break;\r\n        default:\r\n          if (ch <= ' ') {\r\n            out += '&nbsp;';\r\n          } else {\r\n            out += ch;\r\n          }\r\n          break;\r\n      }\r\n\r\n      attr = data;\r\n    }\r\n\r\n    if (attr !== this.defAttr) {\r\n      out += '</span>';\r\n    }\r\n\r\n    this.children[y].innerHTML = out;\r\n  }\r\n\r\n  if (parent) {\r\n    this.element.appendChild(this.rowContainer);\r\n  }\r\n\r\n  this.emit('refresh', {element: this.element, start: start, end: end});\r\n};\r\n\r\n/**\r\n * Display the cursor element\r\n */\r\nTerminal.prototype.showCursor = function() {\r\n  if (!this.cursorState) {\r\n    this.cursorState = 1;\r\n    this.refresh(this.y, this.y);\r\n  }\r\n};\r\n\r\n/**\r\n * Scroll the terminal\r\n */\r\nTerminal.prototype.scroll = function() {\r\n  var row;\r\n\r\n  if (++this.ybase === this.scrollback) {\r\n    this.ybase = this.ybase / 2 | 0;\r\n    this.lines = this.lines.slice(-(this.ybase + this.rows) + 1);\r\n  }\r\n\r\n  this.ydisp = this.ybase;\r\n\r\n  // last line\r\n  row = this.ybase + this.rows - 1;\r\n\r\n  // subtract the bottom scroll region\r\n  row -= this.rows - 1 - this.scrollBottom;\r\n\r\n  if (row === this.lines.length) {\r\n    // potential optimization:\r\n    // pushing is faster than splicing\r\n    // when they amount to the same\r\n    // behavior.\r\n    this.lines.push(this.blankLine());\r\n  } else {\r\n    // add our new line\r\n    this.lines.splice(row, 0, this.blankLine());\r\n  }\r\n\r\n  if (this.scrollTop !== 0) {\r\n    if (this.ybase !== 0) {\r\n      this.ybase--;\r\n      this.ydisp = this.ybase;\r\n    }\r\n    this.lines.splice(this.ybase + this.scrollTop, 1);\r\n  }\r\n\r\n  // this.maxRange();\r\n  this.updateRange(this.scrollTop);\r\n  this.updateRange(this.scrollBottom);\r\n\r\n  this.emit('scroll', this.ydisp);\r\n};\r\n\r\n/**\r\n * Scroll the display of the terminal\r\n * @param {number} disp The number of lines to scroll down (negatives scroll up).\r\n * @param {boolean} suppressScrollEvent Don't emit the scroll event as scrollDisp. This is used\r\n * to avoid unwanted events being handled by the veiwport when the event was triggered from the\r\n * viewport originally.\r\n */\r\nTerminal.prototype.scrollDisp = function(disp, suppressScrollEvent) {\r\n  this.ydisp += disp;\r\n\r\n  if (this.ydisp > this.ybase) {\r\n    this.ydisp = this.ybase;\r\n  } else if (this.ydisp < 0) {\r\n    this.ydisp = 0;\r\n  }\r\n\r\n  if (!suppressScrollEvent) {\r\n    this.emit('scroll', this.ydisp);\r\n  }\r\n\r\n  this.refresh(0, this.rows - 1);\r\n};\r\n\r\n/**\r\n * Writes text to the terminal.\r\n * @param {string} text The text to write to the terminal.\r\n */\r\nTerminal.prototype.write = function(data) {\r\n  var l = data.length, i = 0, j, cs, ch, code, low, ch_width, row;\r\n\r\n  this.refreshStart = this.y;\r\n  this.refreshEnd = this.y;\r\n\r\n  if (this.ybase !== this.ydisp) {\r\n    this.ydisp = this.ybase;\r\n    this.emit('scroll', this.ydisp);\r\n    this.maxRange();\r\n  }\r\n\r\n  // apply leftover surrogate high from last write\r\n  if (this.surrogate_high) {\r\n    data = this.surrogate_high + data;\r\n    this.surrogate_high = '';\r\n  }\r\n\r\n  for (; i < l; i++) {\r\n    ch = data[i];\r\n\r\n    // FIXME: higher chars than 0xa0 are not allowed in escape sequences\r\n    //        --> maybe move to default\r\n    code = data.charCodeAt(i);\r\n    if (0xD800 <= code && code <= 0xDBFF) {\r\n      // we got a surrogate high\r\n      // get surrogate low (next 2 bytes)\r\n      low = data.charCodeAt(i+1);\r\n      if (isNaN(low)) {\r\n        // end of data stream, save surrogate high\r\n        this.surrogate_high = ch;\r\n        continue;\r\n      }\r\n      code = ((code - 0xD800) * 0x400) + (low - 0xDC00) + 0x10000;\r\n      ch += data.charAt(i+1);\r\n    }\r\n    // surrogate low - already handled above\r\n    if (0xDC00 <= code && code <= 0xDFFF)\r\n      continue;\r\n\r\n    switch (this.state) {\r\n      case normal:\r\n        switch (ch) {\r\n          case '\\x07':\r\n            this.bell();\r\n            break;\r\n\r\n          // '\\n', '\\v', '\\f'\r\n          case '\\n':\r\n          case '\\x0b':\r\n          case '\\x0c':\r\n            if (this.convertEol) {\r\n              this.x = 0;\r\n            }\r\n            this.y++;\r\n            if (this.y > this.scrollBottom) {\r\n              this.y--;\r\n              this.scroll();\r\n            }\r\n            break;\r\n\r\n          // '\\r'\r\n          case '\\r':\r\n            this.x = 0;\r\n            break;\r\n\r\n          // '\\b'\r\n          case '\\x08':\r\n            if (this.x > 0) {\r\n              this.x--;\r\n            }\r\n            break;\r\n\r\n          // '\\t'\r\n          case '\\t':\r\n            this.x = this.nextStop();\r\n            break;\r\n\r\n          // shift out\r\n          case '\\x0e':\r\n            this.setgLevel(1);\r\n            break;\r\n\r\n          // shift in\r\n          case '\\x0f':\r\n            this.setgLevel(0);\r\n            break;\r\n\r\n          // '\\e'\r\n          case '\\x1b':\r\n            this.state = escaped;\r\n            break;\r\n\r\n          default:\r\n            // ' '\r\n            // calculate print space\r\n            // expensive call, therefore we save width in line buffer\r\n            ch_width = wcwidth(code);\r\n\r\n            if (ch >= ' ') {\r\n              if (this.charset && this.charset[ch]) {\r\n                ch = this.charset[ch];\r\n              }\r\n\r\n              row = this.y + this.ybase;\r\n\r\n              // insert combining char in last cell\r\n              // FIXME: needs handling after cursor jumps\r\n              if (!ch_width && this.x) {\r\n\r\n                // dont overflow left\r\n                if (this.lines[row][this.x-1]) {\r\n                  if (!this.lines[row][this.x-1][2]) {\r\n\r\n                    // found empty cell after fullwidth, need to go 2 cells back\r\n                    if (this.lines[row][this.x-2])\r\n                      this.lines[row][this.x-2][1] += ch;\r\n\r\n                  } else {\r\n                    this.lines[row][this.x-1][1] += ch;\r\n                  }\r\n                  this.updateRange(this.y);\r\n                }\r\n                break;\r\n              }\r\n\r\n              // goto next line if ch would overflow\r\n              // TODO: needs a global min terminal width of 2\r\n              if (this.x+ch_width-1 >= this.cols) {\r\n                // autowrap - DECAWM\r\n                if (this.wraparoundMode) {\r\n                  this.x = 0;\r\n                  this.y++;\r\n                  if (this.y > this.scrollBottom) {\r\n                    this.y--;\r\n                    this.scroll();\r\n                  }\r\n                } else {\r\n                  this.x = this.cols-1;\r\n                  if(ch_width===2)  // FIXME: check for xterm behavior\r\n                    continue;\r\n                }\r\n              }\r\n              row = this.y + this.ybase;\r\n\r\n              // insert mode: move characters to right\r\n              if (this.insertMode) {\r\n                // do this twice for a fullwidth char\r\n                for (var moves=0; moves<ch_width; ++moves) {\r\n                  // remove last cell, if it's width is 0\r\n                  // we have to adjust the second last cell as well\r\n                  var removed = this.lines[this.y + this.ybase].pop();\r\n                  if (removed[2]===0\r\n                      && this.lines[row][this.cols-2]\r\n                      && this.lines[row][this.cols-2][2]===2)\r\n                    this.lines[row][this.cols-2] = [this.curAttr, ' ', 1];\r\n\r\n                  // insert empty cell at cursor\r\n                  this.lines[row].splice(this.x, 0, [this.curAttr, ' ', 1]);\r\n                }\r\n              }\r\n\r\n              this.lines[row][this.x] = [this.curAttr, ch, ch_width];\r\n              this.x++;\r\n              this.updateRange(this.y);\r\n\r\n              // fullwidth char - set next cell width to zero and advance cursor\r\n              if (ch_width===2) {\r\n                this.lines[row][this.x] = [this.curAttr, '', 0];\r\n                this.x++;\r\n              }\r\n            }\r\n            break;\r\n        }\r\n        break;\r\n      case escaped:\r\n        switch (ch) {\r\n          // ESC [ Control Sequence Introducer ( CSI is 0x9b).\r\n          case '[':\r\n            this.params = [];\r\n            this.currentParam = 0;\r\n            this.state = csi;\r\n            break;\r\n\r\n          // ESC ] Operating System Command ( OSC is 0x9d).\r\n          case ']':\r\n            this.params = [];\r\n            this.currentParam = 0;\r\n            this.state = osc;\r\n            break;\r\n\r\n          // ESC P Device Control String ( DCS is 0x90).\r\n          case 'P':\r\n            this.params = [];\r\n            this.currentParam = 0;\r\n            this.state = dcs;\r\n            break;\r\n\r\n          // ESC _ Application Program Command ( APC is 0x9f).\r\n          case '_':\r\n            this.state = ignore;\r\n            break;\r\n\r\n          // ESC ^ Privacy Message ( PM is 0x9e).\r\n          case '^':\r\n            this.state = ignore;\r\n            break;\r\n\r\n          // ESC c Full Reset (RIS).\r\n          case 'c':\r\n            this.reset();\r\n            break;\r\n\r\n          // ESC E Next Line ( NEL is 0x85).\r\n          // ESC D Index ( IND is 0x84).\r\n          case 'E':\r\n            this.x = 0;\r\n            ;\r\n          case 'D':\r\n            this.index();\r\n            break;\r\n\r\n          // ESC M Reverse Index ( RI is 0x8d).\r\n          case 'M':\r\n            this.reverseIndex();\r\n            break;\r\n\r\n          // ESC % Select default/utf-8 character set.\r\n          // @ = default, G = utf-8\r\n          case '%':\r\n            //this.charset = null;\r\n            this.setgLevel(0);\r\n            this.setgCharset(0, Terminal.charsets.US);\r\n            this.state = normal;\r\n            i++;\r\n            break;\r\n\r\n          // ESC (,),*,+,-,. Designate G0-G2 Character Set.\r\n          case '(': // <-- this seems to get all the attention\r\n          case ')':\r\n          case '*':\r\n          case '+':\r\n          case '-':\r\n          case '.':\r\n            switch (ch) {\r\n              case '(':\r\n                this.gcharset = 0;\r\n                break;\r\n              case ')':\r\n                this.gcharset = 1;\r\n                break;\r\n              case '*':\r\n                this.gcharset = 2;\r\n                break;\r\n              case '+':\r\n                this.gcharset = 3;\r\n                break;\r\n              case '-':\r\n                this.gcharset = 1;\r\n                break;\r\n              case '.':\r\n                this.gcharset = 2;\r\n                break;\r\n            }\r\n            this.state = charset;\r\n            break;\r\n\r\n          // Designate G3 Character Set (VT300).\r\n          // A = ISO Latin-1 Supplemental.\r\n          // Not implemented.\r\n          case '/':\r\n            this.gcharset = 3;\r\n            this.state = charset;\r\n            i--;\r\n            break;\r\n\r\n          // ESC N\r\n          // Single Shift Select of G2 Character Set\r\n          // ( SS2 is 0x8e). This affects next character only.\r\n          case 'N':\r\n            break;\r\n          // ESC O\r\n          // Single Shift Select of G3 Character Set\r\n          // ( SS3 is 0x8f). This affects next character only.\r\n          case 'O':\r\n            break;\r\n          // ESC n\r\n          // Invoke the G2 Character Set as GL (LS2).\r\n          case 'n':\r\n            this.setgLevel(2);\r\n            break;\r\n          // ESC o\r\n          // Invoke the G3 Character Set as GL (LS3).\r\n          case 'o':\r\n            this.setgLevel(3);\r\n            break;\r\n          // ESC |\r\n          // Invoke the G3 Character Set as GR (LS3R).\r\n          case '|':\r\n            this.setgLevel(3);\r\n            break;\r\n          // ESC }\r\n          // Invoke the G2 Character Set as GR (LS2R).\r\n          case '}':\r\n            this.setgLevel(2);\r\n            break;\r\n          // ESC ~\r\n          // Invoke the G1 Character Set as GR (LS1R).\r\n          case '~':\r\n            this.setgLevel(1);\r\n            break;\r\n\r\n          // ESC 7 Save Cursor (DECSC).\r\n          case '7':\r\n            this.saveCursor();\r\n            this.state = normal;\r\n            break;\r\n\r\n          // ESC 8 Restore Cursor (DECRC).\r\n          case '8':\r\n            this.restoreCursor();\r\n            this.state = normal;\r\n            break;\r\n\r\n          // ESC # 3 DEC line height/width\r\n          case '#':\r\n            this.state = normal;\r\n            i++;\r\n            break;\r\n\r\n          // ESC H Tab Set (HTS is 0x88).\r\n          case 'H':\r\n            this.tabSet();\r\n            break;\r\n\r\n          // ESC = Application Keypad (DECKPAM).\r\n          case '=':\r\n            this.log('Serial port requested application keypad.');\r\n            this.applicationKeypad = true;\r\n            this.viewport.setApplicationMode(true);\r\n            this.state = normal;\r\n            break;\r\n\r\n          // ESC > Normal Keypad (DECKPNM).\r\n          case '>':\r\n            this.log('Switching back to normal keypad.');\r\n            this.applicationKeypad = false;\r\n            this.viewport.setApplicationMode(false);\r\n            this.state = normal;\r\n            break;\r\n\r\n          default:\r\n            this.state = normal;\r\n            this.error('Unknown ESC control: %s.', ch);\r\n            break;\r\n        }\r\n        break;\r\n\r\n      case charset:\r\n        switch (ch) {\r\n          case '0': // DEC Special Character and Line Drawing Set.\r\n            cs = Terminal.charsets.SCLD;\r\n            break;\r\n          case 'A': // UK\r\n            cs = Terminal.charsets.UK;\r\n            break;\r\n          case 'B': // United States (USASCII).\r\n            cs = Terminal.charsets.US;\r\n            break;\r\n          case '4': // Dutch\r\n            cs = Terminal.charsets.Dutch;\r\n            break;\r\n          case 'C': // Finnish\r\n          case '5':\r\n            cs = Terminal.charsets.Finnish;\r\n            break;\r\n          case 'R': // French\r\n            cs = Terminal.charsets.French;\r\n            break;\r\n          case 'Q': // FrenchCanadian\r\n            cs = Terminal.charsets.FrenchCanadian;\r\n            break;\r\n          case 'K': // German\r\n            cs = Terminal.charsets.German;\r\n            break;\r\n          case 'Y': // Italian\r\n            cs = Terminal.charsets.Italian;\r\n            break;\r\n          case 'E': // NorwegianDanish\r\n          case '6':\r\n            cs = Terminal.charsets.NorwegianDanish;\r\n            break;\r\n          case 'Z': // Spanish\r\n            cs = Terminal.charsets.Spanish;\r\n            break;\r\n          case 'H': // Swedish\r\n          case '7':\r\n            cs = Terminal.charsets.Swedish;\r\n            break;\r\n          case '=': // Swiss\r\n            cs = Terminal.charsets.Swiss;\r\n            break;\r\n          case '/': // ISOLatin (actually /A)\r\n            cs = Terminal.charsets.ISOLatin;\r\n            i++;\r\n            break;\r\n          default: // Default\r\n            cs = Terminal.charsets.US;\r\n            break;\r\n        }\r\n        this.setgCharset(this.gcharset, cs);\r\n        this.gcharset = null;\r\n        this.state = normal;\r\n        break;\r\n\r\n      case osc:\r\n        // OSC Ps ; Pt ST\r\n        // OSC Ps ; Pt BEL\r\n        //   Set Text Parameters.\r\n        if (ch === '\\x1b' || ch === '\\x07') {\r\n          if (ch === '\\x1b') i++;\r\n\r\n          this.params.push(this.currentParam);\r\n\r\n          switch (this.params[0]) {\r\n            case 0:\r\n            case 1:\r\n            case 2:\r\n              if (this.params[1]) {\r\n                this.title = this.params[1];\r\n                this.handleTitle(this.title);\r\n              }\r\n              break;\r\n            case 3:\r\n              // set X property\r\n              break;\r\n            case 4:\r\n            case 5:\r\n              // change dynamic colors\r\n              break;\r\n            case 10:\r\n            case 11:\r\n            case 12:\r\n            case 13:\r\n            case 14:\r\n            case 15:\r\n            case 16:\r\n            case 17:\r\n            case 18:\r\n            case 19:\r\n              // change dynamic ui colors\r\n              break;\r\n            case 46:\r\n              // change log file\r\n              break;\r\n            case 50:\r\n              // dynamic font\r\n              break;\r\n            case 51:\r\n              // emacs shell\r\n              break;\r\n            case 52:\r\n              // manipulate selection data\r\n              break;\r\n            case 104:\r\n            case 105:\r\n            case 110:\r\n            case 111:\r\n            case 112:\r\n            case 113:\r\n            case 114:\r\n            case 115:\r\n            case 116:\r\n            case 117:\r\n            case 118:\r\n              // reset colors\r\n              break;\r\n          }\r\n\r\n          this.params = [];\r\n          this.currentParam = 0;\r\n          this.state = normal;\r\n        } else {\r\n          if (!this.params.length) {\r\n            if (ch >= '0' && ch <= '9') {\r\n              this.currentParam =\r\n                this.currentParam * 10 + ch.charCodeAt(0) - 48;\r\n            } else if (ch === ';') {\r\n              this.params.push(this.currentParam);\r\n              this.currentParam = '';\r\n            }\r\n          } else {\r\n            this.currentParam += ch;\r\n          }\r\n        }\r\n        break;\r\n\r\n      case csi:\r\n        // '?', '>', '!'\r\n        if (ch === '?' || ch === '>' || ch === '!') {\r\n          this.prefix = ch;\r\n          break;\r\n        }\r\n\r\n        // 0 - 9\r\n        if (ch >= '0' && ch <= '9') {\r\n          this.currentParam = this.currentParam * 10 + ch.charCodeAt(0) - 48;\r\n          break;\r\n        }\r\n\r\n        // '$', '\"', ' ', '\\''\r\n        if (ch === '$' || ch === '\"' || ch === ' ' || ch === '\\'') {\r\n          this.postfix = ch;\r\n          break;\r\n        }\r\n\r\n        this.params.push(this.currentParam);\r\n        this.currentParam = 0;\r\n\r\n        // ';'\r\n        if (ch === ';') break;\r\n\r\n        this.state = normal;\r\n\r\n        switch (ch) {\r\n          // CSI Ps A\r\n          // Cursor Up Ps Times (default = 1) (CUU).\r\n          case 'A':\r\n            this.cursorUp(this.params);\r\n            break;\r\n\r\n          // CSI Ps B\r\n          // Cursor Down Ps Times (default = 1) (CUD).\r\n          case 'B':\r\n            this.cursorDown(this.params);\r\n            break;\r\n\r\n          // CSI Ps C\r\n          // Cursor Forward Ps Times (default = 1) (CUF).\r\n          case 'C':\r\n            this.cursorForward(this.params);\r\n            break;\r\n\r\n          // CSI Ps D\r\n          // Cursor Backward Ps Times (default = 1) (CUB).\r\n          case 'D':\r\n            this.cursorBackward(this.params);\r\n            break;\r\n\r\n          // CSI Ps ; Ps H\r\n          // Cursor Position [row;column] (default = [1,1]) (CUP).\r\n          case 'H':\r\n            this.cursorPos(this.params);\r\n            break;\r\n\r\n          // CSI Ps J  Erase in Display (ED).\r\n          case 'J':\r\n            this.eraseInDisplay(this.params);\r\n            break;\r\n\r\n          // CSI Ps K  Erase in Line (EL).\r\n          case 'K':\r\n            this.eraseInLine(this.params);\r\n            break;\r\n\r\n          // CSI Pm m  Character Attributes (SGR).\r\n          case 'm':\r\n            if (!this.prefix) {\r\n              this.charAttributes(this.params);\r\n            }\r\n            break;\r\n\r\n          // CSI Ps n  Device Status Report (DSR).\r\n          case 'n':\r\n            if (!this.prefix) {\r\n              this.deviceStatus(this.params);\r\n            }\r\n            break;\r\n\r\n            /**\r\n             * Additions\r\n             */\r\n\r\n          // CSI Ps @\r\n          // Insert Ps (Blank) Character(s) (default = 1) (ICH).\r\n          case '@':\r\n            this.insertChars(this.params);\r\n            break;\r\n\r\n          // CSI Ps E\r\n          // Cursor Next Line Ps Times (default = 1) (CNL).\r\n          case 'E':\r\n            this.cursorNextLine(this.params);\r\n            break;\r\n\r\n          // CSI Ps F\r\n          // Cursor Preceding Line Ps Times (default = 1) (CNL).\r\n          case 'F':\r\n            this.cursorPrecedingLine(this.params);\r\n            break;\r\n\r\n          // CSI Ps G\r\n          // Cursor Character Absolute  [column] (default = [row,1]) (CHA).\r\n          case 'G':\r\n            this.cursorCharAbsolute(this.params);\r\n            break;\r\n\r\n          // CSI Ps L\r\n          // Insert Ps Line(s) (default = 1) (IL).\r\n          case 'L':\r\n            this.insertLines(this.params);\r\n            break;\r\n\r\n          // CSI Ps M\r\n          // Delete Ps Line(s) (default = 1) (DL).\r\n          case 'M':\r\n            this.deleteLines(this.params);\r\n            break;\r\n\r\n          // CSI Ps P\r\n          // Delete Ps Character(s) (default = 1) (DCH).\r\n          case 'P':\r\n            this.deleteChars(this.params);\r\n            break;\r\n\r\n          // CSI Ps X\r\n          // Erase Ps Character(s) (default = 1) (ECH).\r\n          case 'X':\r\n            this.eraseChars(this.params);\r\n            break;\r\n\r\n          // CSI Pm `  Character Position Absolute\r\n          //   [column] (default = [row,1]) (HPA).\r\n          case '`':\r\n            this.charPosAbsolute(this.params);\r\n            break;\r\n\r\n          // 141 61 a * HPR -\r\n          // Horizontal Position Relative\r\n          case 'a':\r\n            this.HPositionRelative(this.params);\r\n            break;\r\n\r\n          // CSI P s c\r\n          // Send Device Attributes (Primary DA).\r\n          // CSI > P s c\r\n          // Send Device Attributes (Secondary DA)\r\n          case 'c':\r\n            this.sendDeviceAttributes(this.params);\r\n            break;\r\n\r\n          // CSI Pm d\r\n          // Line Position Absolute  [row] (default = [1,column]) (VPA).\r\n          case 'd':\r\n            this.linePosAbsolute(this.params);\r\n            break;\r\n\r\n          // 145 65 e * VPR - Vertical Position Relative\r\n          case 'e':\r\n            this.VPositionRelative(this.params);\r\n            break;\r\n\r\n          // CSI Ps ; Ps f\r\n          //   Horizontal and Vertical Position [row;column] (default =\r\n          //   [1,1]) (HVP).\r\n          case 'f':\r\n            this.HVPosition(this.params);\r\n            break;\r\n\r\n          // CSI Pm h  Set Mode (SM).\r\n          // CSI ? Pm h - mouse escape codes, cursor escape codes\r\n          case 'h':\r\n            this.setMode(this.params);\r\n            break;\r\n\r\n          // CSI Pm l  Reset Mode (RM).\r\n          // CSI ? Pm l\r\n          case 'l':\r\n            this.resetMode(this.params);\r\n            break;\r\n\r\n          // CSI Ps ; Ps r\r\n          //   Set Scrolling Region [top;bottom] (default = full size of win-\r\n          //   dow) (DECSTBM).\r\n          // CSI ? Pm r\r\n          case 'r':\r\n            this.setScrollRegion(this.params);\r\n            break;\r\n\r\n          // CSI s\r\n          //   Save cursor (ANSI.SYS).\r\n          case 's':\r\n            this.saveCursor(this.params);\r\n            break;\r\n\r\n          // CSI u\r\n          //   Restore cursor (ANSI.SYS).\r\n          case 'u':\r\n            this.restoreCursor(this.params);\r\n            break;\r\n\r\n            /**\r\n             * Lesser Used\r\n             */\r\n\r\n          // CSI Ps I\r\n          // Cursor Forward Tabulation Ps tab stops (default = 1) (CHT).\r\n          case 'I':\r\n            this.cursorForwardTab(this.params);\r\n            break;\r\n\r\n          // CSI Ps S  Scroll up Ps lines (default = 1) (SU).\r\n          case 'S':\r\n            this.scrollUp(this.params);\r\n            break;\r\n\r\n          // CSI Ps T  Scroll down Ps lines (default = 1) (SD).\r\n          // CSI Ps ; Ps ; Ps ; Ps ; Ps T\r\n          // CSI > Ps; Ps T\r\n          case 'T':\r\n            // if (this.prefix === '>') {\r\n            //   this.resetTitleModes(this.params);\r\n            //   break;\r\n            // }\r\n            // if (this.params.length > 2) {\r\n            //   this.initMouseTracking(this.params);\r\n            //   break;\r\n            // }\r\n            if (this.params.length < 2 && !this.prefix) {\r\n              this.scrollDown(this.params);\r\n            }\r\n            break;\r\n\r\n          // CSI Ps Z\r\n          // Cursor Backward Tabulation Ps tab stops (default = 1) (CBT).\r\n          case 'Z':\r\n            this.cursorBackwardTab(this.params);\r\n            break;\r\n\r\n          // CSI Ps b  Repeat the preceding graphic character Ps times (REP).\r\n          case 'b':\r\n            this.repeatPrecedingCharacter(this.params);\r\n            break;\r\n\r\n          // CSI Ps g  Tab Clear (TBC).\r\n          case 'g':\r\n            this.tabClear(this.params);\r\n            break;\r\n\r\n            // CSI Pm i  Media Copy (MC).\r\n            // CSI ? Pm i\r\n            // case 'i':\r\n            //   this.mediaCopy(this.params);\r\n            //   break;\r\n\r\n            // CSI Pm m  Character Attributes (SGR).\r\n            // CSI > Ps; Ps m\r\n            // case 'm': // duplicate\r\n            //   if (this.prefix === '>') {\r\n            //     this.setResources(this.params);\r\n            //   } else {\r\n            //     this.charAttributes(this.params);\r\n            //   }\r\n            //   break;\r\n\r\n            // CSI Ps n  Device Status Report (DSR).\r\n            // CSI > Ps n\r\n            // case 'n': // duplicate\r\n            //   if (this.prefix === '>') {\r\n            //     this.disableModifiers(this.params);\r\n            //   } else {\r\n            //     this.deviceStatus(this.params);\r\n            //   }\r\n            //   break;\r\n\r\n            // CSI > Ps p  Set pointer mode.\r\n            // CSI ! p   Soft terminal reset (DECSTR).\r\n            // CSI Ps$ p\r\n            //   Request ANSI mode (DECRQM).\r\n            // CSI ? Ps$ p\r\n            //   Request DEC private mode (DECRQM).\r\n            // CSI Ps ; Ps \" p\r\n          case 'p':\r\n            switch (this.prefix) {\r\n                // case '>':\r\n                //   this.setPointerMode(this.params);\r\n                //   break;\r\n              case '!':\r\n                this.softReset(this.params);\r\n                break;\r\n                // case '?':\r\n                //   if (this.postfix === '$') {\r\n                //     this.requestPrivateMode(this.params);\r\n                //   }\r\n                //   break;\r\n                // default:\r\n                //   if (this.postfix === '\"') {\r\n                //     this.setConformanceLevel(this.params);\r\n                //   } else if (this.postfix === '$') {\r\n                //     this.requestAnsiMode(this.params);\r\n                //   }\r\n                //   break;\r\n            }\r\n            break;\r\n\r\n            // CSI Ps q  Load LEDs (DECLL).\r\n            // CSI Ps SP q\r\n            // CSI Ps \" q\r\n            // case 'q':\r\n            //   if (this.postfix === ' ') {\r\n            //     this.setCursorStyle(this.params);\r\n            //     break;\r\n            //   }\r\n            //   if (this.postfix === '\"') {\r\n            //     this.setCharProtectionAttr(this.params);\r\n            //     break;\r\n            //   }\r\n            //   this.loadLEDs(this.params);\r\n            //   break;\r\n\r\n            // CSI Ps ; Ps r\r\n            //   Set Scrolling Region [top;bottom] (default = full size of win-\r\n            //   dow) (DECSTBM).\r\n            // CSI ? Pm r\r\n            // CSI Pt; Pl; Pb; Pr; Ps$ r\r\n            // case 'r': // duplicate\r\n            //   if (this.prefix === '?') {\r\n            //     this.restorePrivateValues(this.params);\r\n            //   } else if (this.postfix === '$') {\r\n            //     this.setAttrInRectangle(this.params);\r\n            //   } else {\r\n            //     this.setScrollRegion(this.params);\r\n            //   }\r\n            //   break;\r\n\r\n            // CSI s     Save cursor (ANSI.SYS).\r\n            // CSI ? Pm s\r\n            // case 's': // duplicate\r\n            //   if (this.prefix === '?') {\r\n            //     this.savePrivateValues(this.params);\r\n            //   } else {\r\n            //     this.saveCursor(this.params);\r\n            //   }\r\n            //   break;\r\n\r\n            // CSI Ps ; Ps ; Ps t\r\n            // CSI Pt; Pl; Pb; Pr; Ps$ t\r\n            // CSI > Ps; Ps t\r\n            // CSI Ps SP t\r\n            // case 't':\r\n            //   if (this.postfix === '$') {\r\n            //     this.reverseAttrInRectangle(this.params);\r\n            //   } else if (this.postfix === ' ') {\r\n            //     this.setWarningBellVolume(this.params);\r\n            //   } else {\r\n            //     if (this.prefix === '>') {\r\n            //       this.setTitleModeFeature(this.params);\r\n            //     } else {\r\n            //       this.manipulateWindow(this.params);\r\n            //     }\r\n            //   }\r\n            //   break;\r\n\r\n            // CSI u     Restore cursor (ANSI.SYS).\r\n            // CSI Ps SP u\r\n            // case 'u': // duplicate\r\n            //   if (this.postfix === ' ') {\r\n            //     this.setMarginBellVolume(this.params);\r\n            //   } else {\r\n            //     this.restoreCursor(this.params);\r\n            //   }\r\n            //   break;\r\n\r\n            // CSI Pt; Pl; Pb; Pr; Pp; Pt; Pl; Pp$ v\r\n            // case 'v':\r\n            //   if (this.postfix === '$') {\r\n            //     this.copyRectagle(this.params);\r\n            //   }\r\n            //   break;\r\n\r\n            // CSI Pt ; Pl ; Pb ; Pr ' w\r\n            // case 'w':\r\n            //   if (this.postfix === '\\'') {\r\n            //     this.enableFilterRectangle(this.params);\r\n            //   }\r\n            //   break;\r\n\r\n            // CSI Ps x  Request Terminal Parameters (DECREQTPARM).\r\n            // CSI Ps x  Select Attribute Change Extent (DECSACE).\r\n            // CSI Pc; Pt; Pl; Pb; Pr$ x\r\n            // case 'x':\r\n            //   if (this.postfix === '$') {\r\n            //     this.fillRectangle(this.params);\r\n            //   } else {\r\n            //     this.requestParameters(this.params);\r\n            //     //this.__(this.params);\r\n            //   }\r\n            //   break;\r\n\r\n            // CSI Ps ; Pu ' z\r\n            // CSI Pt; Pl; Pb; Pr$ z\r\n            // case 'z':\r\n            //   if (this.postfix === '\\'') {\r\n            //     this.enableLocatorReporting(this.params);\r\n            //   } else if (this.postfix === '$') {\r\n            //     this.eraseRectangle(this.params);\r\n            //   }\r\n            //   break;\r\n\r\n            // CSI Pm ' {\r\n            // CSI Pt; Pl; Pb; Pr$ {\r\n            // case '{':\r\n            //   if (this.postfix === '\\'') {\r\n            //     this.setLocatorEvents(this.params);\r\n            //   } else if (this.postfix === '$') {\r\n            //     this.selectiveEraseRectangle(this.params);\r\n            //   }\r\n            //   break;\r\n\r\n            // CSI Ps ' |\r\n            // case '|':\r\n            //   if (this.postfix === '\\'') {\r\n            //     this.requestLocatorPosition(this.params);\r\n            //   }\r\n            //   break;\r\n\r\n            // CSI P m SP }\r\n            // Insert P s Column(s) (default = 1) (DECIC), VT420 and up.\r\n            // case '}':\r\n            //   if (this.postfix === ' ') {\r\n            //     this.insertColumns(this.params);\r\n            //   }\r\n            //   break;\r\n\r\n            // CSI P m SP ~\r\n            // Delete P s Column(s) (default = 1) (DECDC), VT420 and up\r\n            // case '~':\r\n            //   if (this.postfix === ' ') {\r\n            //     this.deleteColumns(this.params);\r\n            //   }\r\n            //   break;\r\n\r\n          default:\r\n            this.error('Unknown CSI code: %s.', ch);\r\n            break;\r\n        }\r\n\r\n        this.prefix = '';\r\n        this.postfix = '';\r\n        break;\r\n\r\n      case dcs:\r\n        if (ch === '\\x1b' || ch === '\\x07') {\r\n          if (ch === '\\x1b') i++;\r\n\r\n          switch (this.prefix) {\r\n            // User-Defined Keys (DECUDK).\r\n            case '':\r\n              break;\r\n\r\n            // Request Status String (DECRQSS).\r\n            // test: echo -e '\\eP$q\"p\\e\\\\'\r\n            case '$q':\r\n              var pt = this.currentParam\r\n              , valid = false;\r\n\r\n              switch (pt) {\r\n                // DECSCA\r\n                case '\"q':\r\n                  pt = '0\"q';\r\n                  break;\r\n\r\n                // DECSCL\r\n                case '\"p':\r\n                  pt = '61\"p';\r\n                  break;\r\n\r\n                // DECSTBM\r\n                case 'r':\r\n                  pt = ''\r\n                    + (this.scrollTop + 1)\r\n                    + ';'\r\n                    + (this.scrollBottom + 1)\r\n                    + 'r';\r\n                  break;\r\n\r\n                // SGR\r\n                case 'm':\r\n                  pt = '0m';\r\n                  break;\r\n\r\n                default:\r\n                  this.error('Unknown DCS Pt: %s.', pt);\r\n                  pt = '';\r\n                  break;\r\n              }\r\n\r\n              this.send('\\x1bP' + +valid + '$r' + pt + '\\x1b\\\\');\r\n              break;\r\n\r\n            // Set Termcap/Terminfo Data (xterm, experimental).\r\n            case '+p':\r\n              break;\r\n\r\n            // Request Termcap/Terminfo String (xterm, experimental)\r\n            // Regular xterm does not even respond to this sequence.\r\n            // This can cause a small glitch in vim.\r\n            // test: echo -ne '\\eP+q6b64\\e\\\\'\r\n            case '+q':\r\n              var pt = this.currentParam\r\n              , valid = false;\r\n\r\n              this.send('\\x1bP' + +valid + '+r' + pt + '\\x1b\\\\');\r\n              break;\r\n\r\n            default:\r\n              this.error('Unknown DCS prefix: %s.', this.prefix);\r\n              break;\r\n          }\r\n\r\n          this.currentParam = 0;\r\n          this.prefix = '';\r\n          this.state = normal;\r\n        } else if (!this.currentParam) {\r\n          if (!this.prefix && ch !== '$' && ch !== '+') {\r\n            this.currentParam = ch;\r\n          } else if (this.prefix.length === 2) {\r\n            this.currentParam = ch;\r\n          } else {\r\n            this.prefix += ch;\r\n          }\r\n        } else {\r\n          this.currentParam += ch;\r\n        }\r\n        break;\r\n\r\n      case ignore:\r\n        // For PM and APC.\r\n        if (ch === '\\x1b' || ch === '\\x07') {\r\n          if (ch === '\\x1b') i++;\r\n          this.state = normal;\r\n        }\r\n        break;\r\n    }\r\n  }\r\n\r\n  this.updateRange(this.y);\r\n  this.refresh(this.refreshStart, this.refreshEnd);\r\n};\r\n\r\n/**\r\n * Writes text to the terminal, followed by a break line character (\\n).\r\n * @param {string} text The text to write to the terminal.\r\n */\r\nTerminal.prototype.writeln = function(data) {\r\n  this.write(data + '\\r\\n');\r\n};\r\n\r\n/**\r\n * Attaches a custom keydown handler which is run before keys are processed, giving consumers of\r\n * xterm.js ultimate control as to what keys should be processed by the terminal and what keys\r\n * should not.\r\n * @param {function} customKeydownHandler The custom KeyboardEvent handler to attach. This is a\r\n *   function that takes a KeyboardEvent, allowing consumers to stop propogation and/or prevent\r\n *   the default action. The function returns whether the event should be processed by xterm.js.\r\n */\r\nTerminal.prototype.attachCustomKeydownHandler = function(customKeydownHandler) {\r\n  this.customKeydownHandler = customKeydownHandler;\r\n}\r\n\r\n/**\r\n * Handle a keydown event\r\n * Key Resources:\r\n *   - https://developer.mozilla.org/en-US/docs/DOM/KeyboardEvent\r\n * @param {KeyboardEvent} ev The keydown event to be handled.\r\n */\r\nTerminal.prototype.keyDown = function(ev) {\r\n  if (this.customKeydownHandler && this.customKeydownHandler(ev) === false) {\r\n    return false;\r\n  }\r\n\r\n  if (!this.compositionHelper.keydown.bind(this.compositionHelper)(ev)) {\r\n    return false;\r\n  }\r\n\r\n  var self = this;\r\n  var result = this.evaluateKeyEscapeSequence(ev);\r\n\r\n  if (result.scrollDisp) {\r\n    this.scrollDisp(result.scrollDisp);\r\n    return this.cancel(ev);\r\n  }\r\n\r\n  if (isThirdLevelShift(this, ev)) {\r\n    return true;\r\n  }\r\n\r\n  if (result.cancel ) {\r\n    // The event is canceled at the end already, is this necessary?\r\n    this.cancel(ev, true);\r\n  }\r\n\r\n  if (!result.key) {\r\n    return true;\r\n  }\r\n\r\n  this.emit('keydown', ev);\r\n  this.emit('key', result.key, ev);\r\n  this.showCursor();\r\n  this.handler(result.key);\r\n\r\n  return this.cancel(ev, true);\r\n};\r\n\r\n/**\r\n * Returns an object that determines how a KeyboardEvent should be handled. The key of the\r\n * returned value is the new key code to pass to the PTY.\r\n *\r\n * Reference: http://invisible-island.net/xterm/ctlseqs/ctlseqs.html\r\n * @param {KeyboardEvent} ev The keyboard event to be translated to key escape sequence.\r\n */\r\nTerminal.prototype.evaluateKeyEscapeSequence = function(ev) {\r\n  var result = {\r\n    // Whether to cancel event propogation (NOTE: this may not be needed since the event is\r\n    // canceled at the end of keyDown\r\n    cancel: false,\r\n    // The new key even to emit\r\n    key: undefined,\r\n    // The number of characters to scroll, if this is defined it will cancel the event\r\n    scrollDisp: undefined\r\n  };\r\n  var modifiers = ev.shiftKey << 0 | ev.altKey << 1 | ev.ctrlKey << 2 | ev.metaKey << 3;\r\n  switch (ev.keyCode) {\r\n      // backspace\r\n    case 8:\r\n      if (ev.shiftKey) {\r\n        result.key = '\\x08'; // ^H\r\n        break;\r\n      }\r\n      result.key = '\\x7f'; // ^?\r\n      break;\r\n      // tab\r\n    case 9:\r\n      if (ev.shiftKey) {\r\n        result.key = '\\x1b[Z';\r\n        break;\r\n      }\r\n      result.key = '\\t';\r\n      result.cancel = true;\r\n      break;\r\n      // return/enter\r\n    case 13:\r\n      result.key = '\\r';\r\n      result.cancel = true;\r\n      break;\r\n      // escape\r\n    case 27:\r\n      result.key = '\\x1b';\r\n      result.cancel = true;\r\n      break;\r\n      // left-arrow\r\n    case 37:\r\n      if (modifiers) {\r\n        result.key = '\\x1b[1;' + (modifiers + 1) + 'D';\r\n        // HACK: Make Alt + left-arrow behave like Ctrl + left-arrow: move one word backwards\r\n        // http://unix.stackexchange.com/a/108106\r\n        if (result.key == '\\x1b[1;3D') {\r\n          result.key = '\\x1b[1;5D';\r\n        }\r\n      } else if (this.applicationCursor) {\r\n        result.key = '\\x1bOD';\r\n      } else {\r\n        result.key = '\\x1b[D';\r\n      }\r\n      break;\r\n      // right-arrow\r\n    case 39:\r\n      if (modifiers) {\r\n        result.key = '\\x1b[1;' + (modifiers + 1) + 'C';\r\n        // HACK: Make Alt + right-arrow behave like Ctrl + right-arrow: move one word forward\r\n        // http://unix.stackexchange.com/a/108106\r\n        if (result.key == '\\x1b[1;3C') {\r\n          result.key = '\\x1b[1;5C';\r\n        }\r\n      } else if (this.applicationCursor) {\r\n        result.key = '\\x1bOC';\r\n      } else {\r\n        result.key = '\\x1b[C';\r\n      }\r\n      break;\r\n      // up-arrow\r\n    case 38:\r\n      if (modifiers) {\r\n        result.key = '\\x1b[1;' + (modifiers + 1) + 'A';\r\n        // HACK: Make Alt + up-arrow behave like Ctrl + up-arrow\r\n        // http://unix.stackexchange.com/a/108106\r\n        if (result.key == '\\x1b[1;3A') {\r\n          result.key = '\\x1b[1;5A';\r\n        }\r\n      } else if (this.applicationCursor) {\r\n        result.key = '\\x1bOA';\r\n      } else {\r\n        result.key = '\\x1b[A';\r\n      }\r\n      break;\r\n      // down-arrow\r\n    case 40:\r\n      if (modifiers) {\r\n        result.key = '\\x1b[1;' + (modifiers + 1) + 'B';\r\n        // HACK: Make Alt + down-arrow behave like Ctrl + down-arrow\r\n        // http://unix.stackexchange.com/a/108106\r\n        if (result.key == '\\x1b[1;3B') {\r\n          result.key = '\\x1b[1;5B';\r\n        }\r\n      } else if (this.applicationCursor) {\r\n        result.key = '\\x1bOB';\r\n      } else {\r\n        result.key = '\\x1b[B';\r\n      }\r\n      break;\r\n      // insert\r\n    case 45:\r\n      if (!ev.shiftKey && !ev.ctrlKey) {\r\n        // <Ctrl> or <Shift> + <Insert> are used to\r\n        // copy-paste on some systems.\r\n        result.key = '\\x1b[2~';\r\n      }\r\n      break;\r\n      // delete\r\n    case 46:\r\n      if (modifiers) {\r\n        result.key = '\\x1b[3;' + (modifiers + 1) + '~';\r\n      } else {\r\n        result.key = '\\x1b[3~';\r\n      }\r\n      break;\r\n      // home\r\n    case 36:\r\n      if (modifiers)\r\n        result.key = '\\x1b[1;' + (modifiers + 1) + 'H';\r\n      else if (this.applicationCursor)\r\n        result.key = '\\x1bOH';\r\n      else\r\n        result.key = '\\x1b[H';\r\n      break;\r\n      // end\r\n    case 35:\r\n      if (modifiers)\r\n        result.key = '\\x1b[1;' + (modifiers + 1) + 'F';\r\n      else if (this.applicationCursor)\r\n        result.key = '\\x1bOF';\r\n      else\r\n        result.key = '\\x1b[F';\r\n      break;\r\n      // page up\r\n    case 33:\r\n      if (ev.shiftKey) {\r\n        result.scrollDisp = -(this.rows - 1);\r\n      } else {\r\n        result.key = '\\x1b[5~';\r\n      }\r\n      break;\r\n      // page down\r\n    case 34:\r\n      if (ev.shiftKey) {\r\n        result.scrollDisp = this.rows - 1;\r\n      } else {\r\n        result.key = '\\x1b[6~';\r\n      }\r\n      break;\r\n      // F1-F12\r\n    case 112:\r\n      if (modifiers) {\r\n        result.key = '\\x1b[1;' + (modifiers + 1) + 'P';\r\n      } else {\r\n        result.key = '\\x1bOP';\r\n      }\r\n      break;\r\n    case 113:\r\n      if (modifiers) {\r\n        result.key = '\\x1b[1;' + (modifiers + 1) + 'Q';\r\n      } else {\r\n        result.key = '\\x1bOQ';\r\n      }\r\n      break;\r\n    case 114:\r\n      if (modifiers) {\r\n        result.key = '\\x1b[1;' + (modifiers + 1) + 'R';\r\n      } else {\r\n        result.key = '\\x1bOR';\r\n      }\r\n      break;\r\n    case 115:\r\n      if (modifiers) {\r\n        result.key = '\\x1b[1;' + (modifiers + 1) + 'S';\r\n      } else {\r\n        result.key = '\\x1bOS';\r\n      }\r\n      break;\r\n    case 116:\r\n      if (modifiers) {\r\n        result.key = '\\x1b[15;' + (modifiers + 1) + '~';\r\n      } else {\r\n        result.key = '\\x1b[15~';\r\n      }\r\n      break;\r\n    case 117:\r\n      if (modifiers) {\r\n        result.key = '\\x1b[17;' + (modifiers + 1) + '~';\r\n      } else {\r\n        result.key = '\\x1b[17~';\r\n      }\r\n      break;\r\n    case 118:\r\n      if (modifiers) {\r\n        result.key = '\\x1b[18;' + (modifiers + 1) + '~';\r\n      } else {\r\n        result.key = '\\x1b[18~';\r\n      }\r\n      break;\r\n    case 119:\r\n      if (modifiers) {\r\n        result.key = '\\x1b[19;' + (modifiers + 1) + '~';\r\n      } else {\r\n        result.key = '\\x1b[19~';\r\n      }\r\n      break;\r\n    case 120:\r\n      if (modifiers) {\r\n        result.key = '\\x1b[20;' + (modifiers + 1) + '~';\r\n      } else {\r\n        result.key = '\\x1b[20~';\r\n      }\r\n      break;\r\n    case 121:\r\n      if (modifiers) {\r\n        result.key = '\\x1b[21;' + (modifiers + 1) + '~';\r\n      } else {\r\n        result.key = '\\x1b[21~';\r\n      }\r\n      break;\r\n    case 122:\r\n      if (modifiers) {\r\n        result.key = '\\x1b[23;' + (modifiers + 1) + '~';\r\n      } else {\r\n        result.key = '\\x1b[23~';\r\n      }\r\n      break;\r\n    case 123:\r\n      if (modifiers) {\r\n        result.key = '\\x1b[24;' + (modifiers + 1) + '~';\r\n      } else {\r\n        result.key = '\\x1b[24~';\r\n      }\r\n      break;\r\n    default:\r\n      // a-z and space\r\n      if (ev.ctrlKey && !ev.shiftKey && !ev.altKey && !ev.metaKey) {\r\n        if (ev.keyCode >= 65 && ev.keyCode <= 90) {\r\n          result.key = String.fromCharCode(ev.keyCode - 64);\r\n        } else if (ev.keyCode === 32) {\r\n          // NUL\r\n          result.key = String.fromCharCode(0);\r\n        } else if (ev.keyCode >= 51 && ev.keyCode <= 55) {\r\n          // escape, file sep, group sep, record sep, unit sep\r\n          result.key = String.fromCharCode(ev.keyCode - 51 + 27);\r\n        } else if (ev.keyCode === 56) {\r\n          // delete\r\n          result.key = String.fromCharCode(127);\r\n        } else if (ev.keyCode === 219) {\r\n          // ^[ - escape\r\n          result.key = String.fromCharCode(27);\r\n        } else if (ev.keyCode === 221) {\r\n          // ^] - group sep\r\n          result.key = String.fromCharCode(29);\r\n        }\r\n      } else if (!this.isMac && ev.altKey && !ev.ctrlKey && !ev.metaKey) {\r\n        // On Mac this is a third level shift. Use <Esc> instead.\r\n        if (ev.keyCode >= 65 && ev.keyCode <= 90) {\r\n          result.key = '\\x1b' + String.fromCharCode(ev.keyCode + 32);\r\n        } else if (ev.keyCode === 192) {\r\n          result.key = '\\x1b`';\r\n        } else if (ev.keyCode >= 48 && ev.keyCode <= 57) {\r\n          result.key = '\\x1b' + (ev.keyCode - 48);\r\n        }\r\n      }\r\n      break;\r\n  }\r\n  return result;\r\n};\r\n\r\n/**\r\n * Set the G level of the terminal\r\n * @param g\r\n */\r\nTerminal.prototype.setgLevel = function(g) {\r\n  this.glevel = g;\r\n  this.charset = this.charsets[g];\r\n};\r\n\r\n/**\r\n * Set the charset for the given G level of the terminal\r\n * @param g\r\n * @param charset\r\n */\r\nTerminal.prototype.setgCharset = function(g, charset) {\r\n  this.charsets[g] = charset;\r\n  if (this.glevel === g) {\r\n    this.charset = charset;\r\n  }\r\n};\r\n\r\n/**\r\n * Handle a keypress event.\r\n * Key Resources:\r\n *   - https://developer.mozilla.org/en-US/docs/DOM/KeyboardEvent\r\n * @param {KeyboardEvent} ev The keypress event to be handled.\r\n */\r\nTerminal.prototype.keyPress = function(ev) {\r\n  var key;\r\n\r\n  this.cancel(ev);\r\n\r\n  if (ev.charCode) {\r\n    key = ev.charCode;\r\n  } else if (ev.which == null) {\r\n    key = ev.keyCode;\r\n  } else if (ev.which !== 0 && ev.charCode !== 0) {\r\n    key = ev.which;\r\n  } else {\r\n    return false;\r\n  }\r\n\r\n  if (!key || (\r\n    (ev.altKey || ev.ctrlKey || ev.metaKey) && !isThirdLevelShift(this, ev)\r\n  )) {\r\n    return false;\r\n  }\r\n\r\n  key = String.fromCharCode(key);\r\n\r\n  this.emit('keypress', key, ev);\r\n  this.emit('key', key, ev);\r\n  this.showCursor();\r\n  this.handler(key);\r\n\r\n  return false;\r\n};\r\n\r\n/**\r\n * Send data for handling to the terminal\r\n * @param {string} data\r\n */\r\nTerminal.prototype.send = function(data) {\r\n  var self = this;\r\n\r\n  if (!this.queue) {\r\n    setTimeout(function() {\r\n      self.handler(self.queue);\r\n      self.queue = '';\r\n    }, 1);\r\n  }\r\n\r\n  this.queue += data;\r\n};\r\n\r\n/**\r\n * Ring the bell.\r\n * Note: We could do sweet things with webaudio here\r\n */\r\nTerminal.prototype.bell = function() {\r\n  if (!this.visualBell) return;\r\n  var self = this;\r\n  this.element.style.borderColor = 'white';\r\n  setTimeout(function() {\r\n    self.element.style.borderColor = '';\r\n  }, 10);\r\n  if (this.popOnBell) this.focus();\r\n};\r\n\r\n/**\r\n * Log the current state to the console.\r\n */\r\nTerminal.prototype.log = function() {\r\n  if (!this.debug) return;\r\n  if (!this.context.console || !this.context.console.log) return;\r\n  var args = Array.prototype.slice.call(arguments);\r\n  this.context.console.log.apply(this.context.console, args);\r\n};\r\n\r\n/**\r\n * Log the current state as error to the console.\r\n */\r\nTerminal.prototype.error = function() {\r\n  if (!this.debug) return;\r\n  if (!this.context.console || !this.context.console.error) return;\r\n  var args = Array.prototype.slice.call(arguments);\r\n  this.context.console.error.apply(this.context.console, args);\r\n};\r\n\r\n/**\r\n * Resizes the terminal.\r\n *\r\n * @param {number} x The number of columns to resize to.\r\n * @param {number} y The number of rows to resize to.\r\n */\r\nTerminal.prototype.resize = function(x, y) {\r\n  var line\r\n  , el\r\n  , i\r\n  , j\r\n  , ch\r\n  , addToY;\r\n\r\n  if (x === this.cols && y === this.rows) {\r\n    return;\r\n  }\r\n\r\n  if (x < 1) x = 1;\r\n  if (y < 1) y = 1;\r\n\r\n  // resize cols\r\n  j = this.cols;\r\n  if (j < x) {\r\n    ch = [this.defAttr, ' ', 1]; // does xterm use the default attr?\r\n    i = this.lines.length;\r\n    while (i--) {\r\n      while (this.lines[i].length < x) {\r\n        this.lines[i].push(ch);\r\n      }\r\n    }\r\n  } else { // (j > x)\r\n    i = this.lines.length;\r\n    while (i--) {\r\n      while (this.lines[i].length > x) {\r\n        this.lines[i].pop();\r\n      }\r\n    }\r\n  }\r\n  this.setupStops(j);\r\n  this.cols = x;\r\n\r\n  // resize rows\r\n  j = this.rows;\r\n  addToY = 0;\r\n  if (j < y) {\r\n    el = this.element;\r\n    while (j++ < y) {\r\n      // y is rows, not this.y\r\n      if (this.lines.length < y + this.ybase) {\r\n        if (this.ybase > 0 && this.lines.length <= this.ybase + this.y + addToY + 1) {\r\n          // There is room above the buffer and there are no empty elements below the line,\r\n          // scroll up\r\n          this.ybase--;\r\n          addToY++\r\n          if (this.ydisp > 0) {\r\n            // Viewport is at the top of the buffer, must increase downwards\r\n            this.ydisp--;\r\n          }\r\n        } else {\r\n          // Add a blank line if there is no buffer left at the top to scroll to, or if there\r\n          // are blank lines after the cursor\r\n          this.lines.push(this.blankLine());\r\n        }\r\n      }\r\n      if (this.children.length < y) {\r\n        this.insertRow();\r\n      }\r\n    }\r\n  } else { // (j > y)\r\n    while (j-- > y) {\r\n      if (this.lines.length > y + this.ybase) {\r\n        if (this.lines.length > this.ybase + this.y + 1) {\r\n          // The line is a blank line below the cursor, remove it\r\n          this.lines.pop();\r\n        } else {\r\n          // The line is the cursor, scroll down\r\n          this.ybase++;\r\n          this.ydisp++;\r\n        }\r\n      }\r\n      if (this.children.length > y) {\r\n        el = this.children.shift();\r\n        if (!el) continue;\r\n        el.parentNode.removeChild(el);\r\n      }\r\n    }\r\n  }\r\n  this.rows = y;\r\n\r\n  // Make sure that the cursor stays on screen\r\n  if (this.y >= y) {\r\n    this.y = y - 1;\r\n  }\r\n  if (addToY) {\r\n    this.y += addToY;\r\n  }\r\n\r\n  if (this.x >= x) {\r\n    this.x = x - 1;\r\n  }\r\n\r\n  this.scrollTop = 0;\r\n  this.scrollBottom = y - 1;\r\n\r\n  this.refresh(0, this.rows - 1);\r\n\r\n  this.normal = null;\r\n\r\n  this.emit('resize', {terminal: this, cols: x, rows: y});\r\n};\r\n\r\n/**\r\n * Updates the range of rows to refresh\r\n * @param {number} y The number of rows to refresh next.\r\n */\r\nTerminal.prototype.updateRange = function(y) {\r\n  if (y < this.refreshStart) this.refreshStart = y;\r\n  if (y > this.refreshEnd) this.refreshEnd = y;\r\n  // if (y > this.refreshEnd) {\r\n  //   this.refreshEnd = y;\r\n  //   if (y > this.rows - 1) {\r\n  //     this.refreshEnd = this.rows - 1;\r\n  //   }\r\n  // }\r\n};\r\n\r\n/**\r\n * Set the range of refreshing to the maximyum value\r\n */\r\nTerminal.prototype.maxRange = function() {\r\n  this.refreshStart = 0;\r\n  this.refreshEnd = this.rows - 1;\r\n};\r\n\r\n\r\n\r\n/**\r\n * Setup the tab stops.\r\n * @param {number} i\r\n */\r\nTerminal.prototype.setupStops = function(i) {\r\n  if (i != null) {\r\n    if (!this.tabs[i]) {\r\n      i = this.prevStop(i);\r\n    }\r\n  } else {\r\n    this.tabs = {};\r\n    i = 0;\r\n  }\r\n\r\n  for (; i < this.cols; i += 8) {\r\n    this.tabs[i] = true;\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Move the cursor to the previous tab stop from the given position (default is current).\r\n * @param {number} x The position to move the cursor to the previous tab stop.\r\n */\r\nTerminal.prototype.prevStop = function(x) {\r\n  if (x == null) x = this.x;\r\n  while (!this.tabs[--x] && x > 0);\r\n  return x >= this.cols\r\n    ? this.cols - 1\r\n  : x < 0 ? 0 : x;\r\n};\r\n\r\n\r\n/**\r\n * Move the cursor one tab stop forward from the given position (default is current).\r\n * @param {number} x The position to move the cursor one tab stop forward.\r\n */\r\nTerminal.prototype.nextStop = function(x) {\r\n  if (x == null) x = this.x;\r\n  while (!this.tabs[++x] && x < this.cols);\r\n  return x >= this.cols\r\n    ? this.cols - 1\r\n  : x < 0 ? 0 : x;\r\n};\r\n\r\n\r\n/**\r\n * Erase in the identified line everything from \"x\" to the end of the line (right).\r\n * @param {number} x The column from which to start erasing to the end of the line.\r\n * @param {number} y The line in which to operate.\r\n */\r\nTerminal.prototype.eraseRight = function(x, y) {\r\n  var line = this.lines[this.ybase + y]\r\n  , ch = [this.eraseAttr(), ' ', 1]; // xterm\r\n\r\n\r\n  for (; x < this.cols; x++) {\r\n    line[x] = ch;\r\n  }\r\n\r\n  this.updateRange(y);\r\n};\r\n\r\n\r\n\r\n/**\r\n * Erase in the identified line everything from \"x\" to the start of the line (left).\r\n * @param {number} x The column from which to start erasing to the start of the line.\r\n * @param {number} y The line in which to operate.\r\n */\r\nTerminal.prototype.eraseLeft = function(x, y) {\r\n  var line = this.lines[this.ybase + y]\r\n  , ch = [this.eraseAttr(), ' ', 1]; // xterm\r\n\r\n  x++;\r\n  while (x--) line[x] = ch;\r\n\r\n  this.updateRange(y);\r\n};\r\n\r\n/**\r\n * Clears the entire buffer, making the prompt line the new first line.\r\n */\r\nTerminal.prototype.clear = function() {\r\n  if (this.ybase === 0 && this.y === 0) {\r\n    // Don't clear if it's already clear\r\n    return;\r\n  }\r\n  this.lines = [this.lines[this.ybase + this.y]];\r\n  this.ydisp = 0;\r\n  this.ybase = 0;\r\n  this.y = 0;\r\n  for (var i = 1; i < this.rows; i++) {\r\n    this.lines.push(this.blankLine());\r\n  }\r\n  this.refresh(0, this.rows - 1);\r\n  this.emit('scroll', this.ydisp);\r\n};\r\n\r\n/**\r\n * Erase all content in the given line\r\n * @param {number} y The line to erase all of its contents.\r\n */\r\nTerminal.prototype.eraseLine = function(y) {\r\n  this.eraseRight(0, y);\r\n};\r\n\r\n\r\n/**\r\n * Return the data array of a blank line/\r\n * @param {number} cur First bunch of data for each \"blank\" character.\r\n */\r\nTerminal.prototype.blankLine = function(cur) {\r\n  var attr = cur\r\n  ? this.eraseAttr()\r\n  : this.defAttr;\r\n\r\n  var ch = [attr, ' ', 1]  // width defaults to 1 halfwidth character\r\n  , line = []\r\n  , i = 0;\r\n\r\n  for (; i < this.cols; i++) {\r\n    line[i] = ch;\r\n  }\r\n\r\n  return line;\r\n};\r\n\r\n\r\n/**\r\n * If cur return the back color xterm feature attribute. Else return defAttr.\r\n * @param {object} cur\r\n */\r\nTerminal.prototype.ch = function(cur) {\r\n  return cur\r\n    ? [this.eraseAttr(), ' ', 1]\r\n  : [this.defAttr, ' ', 1];\r\n};\r\n\r\n\r\n/**\r\n * Evaluate if the current erminal is the given argument.\r\n * @param {object} term The terminal to evaluate\r\n */\r\nTerminal.prototype.is = function(term) {\r\n  var name = this.termName;\r\n  return (name + '').indexOf(term) === 0;\r\n};\r\n\r\n\r\n/**\r\n     * Emit the 'data' event and populate the given data.\r\n     * @param {string} data The data to populate in the event.\r\n     */\r\nTerminal.prototype.handler = function(data) {\r\n  this.emit('data', data);\r\n};\r\n\r\n\r\n/**\r\n * Emit the 'title' event and populate the given title.\r\n * @param {string} title The title to populate in the event.\r\n */\r\nTerminal.prototype.handleTitle = function(title) {\r\n  this.emit('title', title);\r\n};\r\n\r\n\r\n/**\r\n * ESC\r\n */\r\n\r\n/**\r\n * ESC D Index (IND is 0x84).\r\n */\r\nTerminal.prototype.index = function() {\r\n  this.y++;\r\n  if (this.y > this.scrollBottom) {\r\n    this.y--;\r\n    this.scroll();\r\n  }\r\n  this.state = normal;\r\n};\r\n\r\n\r\n/**\r\n * ESC M Reverse Index (RI is 0x8d).\r\n */\r\nTerminal.prototype.reverseIndex = function() {\r\n  var j;\r\n  this.y--;\r\n  if (this.y < this.scrollTop) {\r\n    this.y++;\r\n    // possibly move the code below to term.reverseScroll();\r\n    // test: echo -ne '\\e[1;1H\\e[44m\\eM\\e[0m'\r\n    // blankLine(true) is xterm/linux behavior\r\n    this.lines.splice(this.y + this.ybase, 0, this.blankLine(true));\r\n    j = this.rows - 1 - this.scrollBottom;\r\n    this.lines.splice(this.rows - 1 + this.ybase - j + 1, 1);\r\n    // this.maxRange();\r\n    this.updateRange(this.scrollTop);\r\n    this.updateRange(this.scrollBottom);\r\n  }\r\n  this.state = normal;\r\n};\r\n\r\n\r\n/**\r\n * ESC c Full Reset (RIS).\r\n */\r\nTerminal.prototype.reset = function() {\r\n  this.options.rows = this.rows;\r\n  this.options.cols = this.cols;\r\n  var customKeydownHandler = this.customKeydownHandler;\r\n  Terminal.call(this, this.options);\r\n  this.customKeydownHandler = customKeydownHandler;\r\n  this.refresh(0, this.rows - 1);\r\n};\r\n\r\n\r\n/**\r\n * ESC H Tab Set (HTS is 0x88).\r\n */\r\nTerminal.prototype.tabSet = function() {\r\n  this.tabs[this.x] = true;\r\n  this.state = normal;\r\n};\r\n\r\n\r\n/**\r\n * CSI\r\n */\r\n\r\n/**\r\n * CSI Ps A\r\n * Cursor Up Ps Times (default = 1) (CUU).\r\n */\r\nTerminal.prototype.cursorUp = function(params) {\r\n  var param = params[0];\r\n  if (param < 1) param = 1;\r\n  this.y -= param;\r\n  if (this.y < 0) this.y = 0;\r\n};\r\n\r\n\r\n/**\r\n * CSI Ps B\r\n * Cursor Down Ps Times (default = 1) (CUD).\r\n */\r\nTerminal.prototype.cursorDown = function(params) {\r\n  var param = params[0];\r\n  if (param < 1) param = 1;\r\n  this.y += param;\r\n  if (this.y >= this.rows) {\r\n    this.y = this.rows - 1;\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * CSI Ps C\r\n * Cursor Forward Ps Times (default = 1) (CUF).\r\n */\r\nTerminal.prototype.cursorForward = function(params) {\r\n  var param = params[0];\r\n  if (param < 1) param = 1;\r\n  this.x += param;\r\n  if (this.x >= this.cols) {\r\n    this.x = this.cols - 1;\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * CSI Ps D\r\n * Cursor Backward Ps Times (default = 1) (CUB).\r\n */\r\nTerminal.prototype.cursorBackward = function(params) {\r\n  var param = params[0];\r\n  if (param < 1) param = 1;\r\n  this.x -= param;\r\n  if (this.x < 0) this.x = 0;\r\n};\r\n\r\n\r\n/**\r\n * CSI Ps ; Ps H\r\n * Cursor Position [row;column] (default = [1,1]) (CUP).\r\n */\r\nTerminal.prototype.cursorPos = function(params) {\r\n  var row, col;\r\n\r\n  row = params[0] - 1;\r\n\r\n  if (params.length >= 2) {\r\n    col = params[1] - 1;\r\n  } else {\r\n    col = 0;\r\n  }\r\n\r\n  if (row < 0) {\r\n    row = 0;\r\n  } else if (row >= this.rows) {\r\n    row = this.rows - 1;\r\n  }\r\n\r\n  if (col < 0) {\r\n    col = 0;\r\n  } else if (col >= this.cols) {\r\n    col = this.cols - 1;\r\n  }\r\n\r\n  this.x = col;\r\n  this.y = row;\r\n};\r\n\r\n\r\n/**\r\n * CSI Ps J  Erase in Display (ED).\r\n *     Ps = 0  -> Erase Below (default).\r\n *     Ps = 1  -> Erase Above.\r\n *     Ps = 2  -> Erase All.\r\n *     Ps = 3  -> Erase Saved Lines (xterm).\r\n * CSI ? Ps J\r\n *   Erase in Display (DECSED).\r\n *     Ps = 0  -> Selective Erase Below (default).\r\n *     Ps = 1  -> Selective Erase Above.\r\n *     Ps = 2  -> Selective Erase All.\r\n */\r\nTerminal.prototype.eraseInDisplay = function(params) {\r\n  var j;\r\n  switch (params[0]) {\r\n    case 0:\r\n      this.eraseRight(this.x, this.y);\r\n      j = this.y + 1;\r\n      for (; j < this.rows; j++) {\r\n        this.eraseLine(j);\r\n      }\r\n      break;\r\n    case 1:\r\n      this.eraseLeft(this.x, this.y);\r\n      j = this.y;\r\n      while (j--) {\r\n        this.eraseLine(j);\r\n      }\r\n      break;\r\n    case 2:\r\n      j = this.rows;\r\n      while (j--) this.eraseLine(j);\r\n      break;\r\n    case 3:\r\n      ; // no saved lines\r\n      break;\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * CSI Ps K  Erase in Line (EL).\r\n *     Ps = 0  -> Erase to Right (default).\r\n *     Ps = 1  -> Erase to Left.\r\n *     Ps = 2  -> Erase All.\r\n * CSI ? Ps K\r\n *   Erase in Line (DECSEL).\r\n *     Ps = 0  -> Selective Erase to Right (default).\r\n *     Ps = 1  -> Selective Erase to Left.\r\n *     Ps = 2  -> Selective Erase All.\r\n */\r\nTerminal.prototype.eraseInLine = function(params) {\r\n  switch (params[0]) {\r\n    case 0:\r\n      this.eraseRight(this.x, this.y);\r\n      break;\r\n    case 1:\r\n      this.eraseLeft(this.x, this.y);\r\n      break;\r\n    case 2:\r\n      this.eraseLine(this.y);\r\n      break;\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * CSI Pm m  Character Attributes (SGR).\r\n *     Ps = 0  -> Normal (default).\r\n *     Ps = 1  -> Bold.\r\n *     Ps = 4  -> Underlined.\r\n *     Ps = 5  -> Blink (appears as Bold).\r\n *     Ps = 7  -> Inverse.\r\n *     Ps = 8  -> Invisible, i.e., hidden (VT300).\r\n *     Ps = 2 2  -> Normal (neither bold nor faint).\r\n *     Ps = 2 4  -> Not underlined.\r\n *     Ps = 2 5  -> Steady (not blinking).\r\n *     Ps = 2 7  -> Positive (not inverse).\r\n *     Ps = 2 8  -> Visible, i.e., not hidden (VT300).\r\n *     Ps = 3 0  -> Set foreground color to Black.\r\n *     Ps = 3 1  -> Set foreground color to Red.\r\n *     Ps = 3 2  -> Set foreground color to Green.\r\n *     Ps = 3 3  -> Set foreground color to Yellow.\r\n *     Ps = 3 4  -> Set foreground color to Blue.\r\n *     Ps = 3 5  -> Set foreground color to Magenta.\r\n *     Ps = 3 6  -> Set foreground color to Cyan.\r\n *     Ps = 3 7  -> Set foreground color to White.\r\n *     Ps = 3 9  -> Set foreground color to default (original).\r\n *     Ps = 4 0  -> Set background color to Black.\r\n *     Ps = 4 1  -> Set background color to Red.\r\n *     Ps = 4 2  -> Set background color to Green.\r\n *     Ps = 4 3  -> Set background color to Yellow.\r\n *     Ps = 4 4  -> Set background color to Blue.\r\n *     Ps = 4 5  -> Set background color to Magenta.\r\n *     Ps = 4 6  -> Set background color to Cyan.\r\n *     Ps = 4 7  -> Set background color to White.\r\n *     Ps = 4 9  -> Set background color to default (original).\r\n *\r\n *   If 16-color support is compiled, the following apply.  Assume\r\n *   that xterm's resources are set so that the ISO color codes are\r\n *   the first 8 of a set of 16.  Then the aixterm colors are the\r\n *   bright versions of the ISO colors:\r\n *     Ps = 9 0  -> Set foreground color to Black.\r\n *     Ps = 9 1  -> Set foreground color to Red.\r\n *     Ps = 9 2  -> Set foreground color to Green.\r\n *     Ps = 9 3  -> Set foreground color to Yellow.\r\n *     Ps = 9 4  -> Set foreground color to Blue.\r\n *     Ps = 9 5  -> Set foreground color to Magenta.\r\n *     Ps = 9 6  -> Set foreground color to Cyan.\r\n *     Ps = 9 7  -> Set foreground color to White.\r\n *     Ps = 1 0 0  -> Set background color to Black.\r\n *     Ps = 1 0 1  -> Set background color to Red.\r\n *     Ps = 1 0 2  -> Set background color to Green.\r\n *     Ps = 1 0 3  -> Set background color to Yellow.\r\n *     Ps = 1 0 4  -> Set background color to Blue.\r\n *     Ps = 1 0 5  -> Set background color to Magenta.\r\n *     Ps = 1 0 6  -> Set background color to Cyan.\r\n *     Ps = 1 0 7  -> Set background color to White.\r\n *\r\n *   If xterm is compiled with the 16-color support disabled, it\r\n *   supports the following, from rxvt:\r\n *     Ps = 1 0 0  -> Set foreground and background color to\r\n *     default.\r\n *\r\n *   If 88- or 256-color support is compiled, the following apply.\r\n *     Ps = 3 8  ; 5  ; Ps -> Set foreground color to the second\r\n *     Ps.\r\n *     Ps = 4 8  ; 5  ; Ps -> Set background color to the second\r\n *     Ps.\r\n */\r\nTerminal.prototype.charAttributes = function(params) {\r\n  // Optimize a single SGR0.\r\n  if (params.length === 1 && params[0] === 0) {\r\n    this.curAttr = this.defAttr;\r\n    return;\r\n  }\r\n\r\n  var l = params.length\r\n  , i = 0\r\n  , flags = this.curAttr >> 18\r\n  , fg = (this.curAttr >> 9) & 0x1ff\r\n  , bg = this.curAttr & 0x1ff\r\n  , p;\r\n\r\n  for (; i < l; i++) {\r\n    p = params[i];\r\n    if (p >= 30 && p <= 37) {\r\n      // fg color 8\r\n      fg = p - 30;\r\n    } else if (p >= 40 && p <= 47) {\r\n      // bg color 8\r\n      bg = p - 40;\r\n    } else if (p >= 90 && p <= 97) {\r\n      // fg color 16\r\n      p += 8;\r\n      fg = p - 90;\r\n    } else if (p >= 100 && p <= 107) {\r\n      // bg color 16\r\n      p += 8;\r\n      bg = p - 100;\r\n    } else if (p === 0) {\r\n      // default\r\n      flags = this.defAttr >> 18;\r\n      fg = (this.defAttr >> 9) & 0x1ff;\r\n      bg = this.defAttr & 0x1ff;\r\n      // flags = 0;\r\n      // fg = 0x1ff;\r\n      // bg = 0x1ff;\r\n    } else if (p === 1) {\r\n      // bold text\r\n      flags |= 1;\r\n    } else if (p === 4) {\r\n      // underlined text\r\n      flags |= 2;\r\n    } else if (p === 5) {\r\n      // blink\r\n      flags |= 4;\r\n    } else if (p === 7) {\r\n      // inverse and positive\r\n      // test with: echo -e '\\e[31m\\e[42mhello\\e[7mworld\\e[27mhi\\e[m'\r\n      flags |= 8;\r\n    } else if (p === 8) {\r\n      // invisible\r\n      flags |= 16;\r\n    } else if (p === 22) {\r\n      // not bold\r\n      flags &= ~1;\r\n    } else if (p === 24) {\r\n      // not underlined\r\n      flags &= ~2;\r\n    } else if (p === 25) {\r\n      // not blink\r\n      flags &= ~4;\r\n    } else if (p === 27) {\r\n      // not inverse\r\n      flags &= ~8;\r\n    } else if (p === 28) {\r\n      // not invisible\r\n      flags &= ~16;\r\n    } else if (p === 39) {\r\n      // reset fg\r\n      fg = (this.defAttr >> 9) & 0x1ff;\r\n    } else if (p === 49) {\r\n      // reset bg\r\n      bg = this.defAttr & 0x1ff;\r\n    } else if (p === 38) {\r\n      // fg color 256\r\n      if (params[i + 1] === 2) {\r\n        i += 2;\r\n        fg = matchColor(\r\n          params[i] & 0xff,\r\n          params[i + 1] & 0xff,\r\n          params[i + 2] & 0xff);\r\n        if (fg === -1) fg = 0x1ff;\r\n        i += 2;\r\n      } else if (params[i + 1] === 5) {\r\n        i += 2;\r\n        p = params[i] & 0xff;\r\n        fg = p;\r\n      }\r\n    } else if (p === 48) {\r\n      // bg color 256\r\n      if (params[i + 1] === 2) {\r\n        i += 2;\r\n        bg = matchColor(\r\n          params[i] & 0xff,\r\n          params[i + 1] & 0xff,\r\n          params[i + 2] & 0xff);\r\n        if (bg === -1) bg = 0x1ff;\r\n        i += 2;\r\n      } else if (params[i + 1] === 5) {\r\n        i += 2;\r\n        p = params[i] & 0xff;\r\n        bg = p;\r\n      }\r\n    } else if (p === 100) {\r\n      // reset fg/bg\r\n      fg = (this.defAttr >> 9) & 0x1ff;\r\n      bg = this.defAttr & 0x1ff;\r\n    } else {\r\n      this.error('Unknown SGR attribute: %d.', p);\r\n    }\r\n  }\r\n\r\n  this.curAttr = (flags << 18) | (fg << 9) | bg;\r\n};\r\n\r\n\r\n/**\r\n * CSI Ps n  Device Status Report (DSR).\r\n *     Ps = 5  -> Status Report.  Result (``OK'') is\r\n *   CSI 0 n\r\n *     Ps = 6  -> Report Cursor Position (CPR) [row;column].\r\n *   Result is\r\n *   CSI r ; c R\r\n * CSI ? Ps n\r\n *   Device Status Report (DSR, DEC-specific).\r\n *     Ps = 6  -> Report Cursor Position (CPR) [row;column] as CSI\r\n *     ? r ; c R (assumes page is zero).\r\n *     Ps = 1 5  -> Report Printer status as CSI ? 1 0  n  (ready).\r\n *     or CSI ? 1 1  n  (not ready).\r\n *     Ps = 2 5  -> Report UDK status as CSI ? 2 0  n  (unlocked)\r\n *     or CSI ? 2 1  n  (locked).\r\n *     Ps = 2 6  -> Report Keyboard status as\r\n *   CSI ? 2 7  ;  1  ;  0  ;  0  n  (North American).\r\n *   The last two parameters apply to VT400 & up, and denote key-\r\n *   board ready and LK01 respectively.\r\n *     Ps = 5 3  -> Report Locator status as\r\n *   CSI ? 5 3  n  Locator available, if compiled-in, or\r\n *   CSI ? 5 0  n  No Locator, if not.\r\n */\r\nTerminal.prototype.deviceStatus = function(params) {\r\n  if (!this.prefix) {\r\n    switch (params[0]) {\r\n      case 5:\r\n        // status report\r\n        this.send('\\x1b[0n');\r\n        break;\r\n      case 6:\r\n        // cursor position\r\n        this.send('\\x1b['\r\n                  + (this.y + 1)\r\n                  + ';'\r\n                  + (this.x + 1)\r\n                  + 'R');\r\n        break;\r\n    }\r\n  } else if (this.prefix === '?') {\r\n    // modern xterm doesnt seem to\r\n    // respond to any of these except ?6, 6, and 5\r\n    switch (params[0]) {\r\n      case 6:\r\n        // cursor position\r\n        this.send('\\x1b[?'\r\n                  + (this.y + 1)\r\n                  + ';'\r\n                  + (this.x + 1)\r\n                  + 'R');\r\n        break;\r\n      case 15:\r\n        // no printer\r\n        // this.send('\\x1b[?11n');\r\n        break;\r\n      case 25:\r\n        // dont support user defined keys\r\n        // this.send('\\x1b[?21n');\r\n        break;\r\n      case 26:\r\n        // north american keyboard\r\n        // this.send('\\x1b[?27;1;0;0n');\r\n        break;\r\n      case 53:\r\n        // no dec locator/mouse\r\n        // this.send('\\x1b[?50n');\r\n        break;\r\n    }\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Additions\r\n */\r\n\r\n/**\r\n * CSI Ps @\r\n * Insert Ps (Blank) Character(s) (default = 1) (ICH).\r\n */\r\nTerminal.prototype.insertChars = function(params) {\r\n  var param, row, j, ch;\r\n\r\n  param = params[0];\r\n  if (param < 1) param = 1;\r\n\r\n  row = this.y + this.ybase;\r\n  j = this.x;\r\n  ch = [this.eraseAttr(), ' ', 1]; // xterm\r\n\r\n  while (param-- && j < this.cols) {\r\n    this.lines[row].splice(j++, 0, ch);\r\n    this.lines[row].pop();\r\n  }\r\n};\r\n\r\n/**\r\n * CSI Ps E\r\n * Cursor Next Line Ps Times (default = 1) (CNL).\r\n * same as CSI Ps B ?\r\n */\r\nTerminal.prototype.cursorNextLine = function(params) {\r\n  var param = params[0];\r\n  if (param < 1) param = 1;\r\n  this.y += param;\r\n  if (this.y >= this.rows) {\r\n    this.y = this.rows - 1;\r\n  }\r\n  this.x = 0;\r\n};\r\n\r\n\r\n/**\r\n * CSI Ps F\r\n * Cursor Preceding Line Ps Times (default = 1) (CNL).\r\n * reuse CSI Ps A ?\r\n */\r\nTerminal.prototype.cursorPrecedingLine = function(params) {\r\n  var param = params[0];\r\n  if (param < 1) param = 1;\r\n  this.y -= param;\r\n  if (this.y < 0) this.y = 0;\r\n  this.x = 0;\r\n};\r\n\r\n\r\n/**\r\n * CSI Ps G\r\n * Cursor Character Absolute  [column] (default = [row,1]) (CHA).\r\n */\r\nTerminal.prototype.cursorCharAbsolute = function(params) {\r\n  var param = params[0];\r\n  if (param < 1) param = 1;\r\n  this.x = param - 1;\r\n};\r\n\r\n\r\n/**\r\n * CSI Ps L\r\n * Insert Ps Line(s) (default = 1) (IL).\r\n */\r\nTerminal.prototype.insertLines = function(params) {\r\n  var param, row, j;\r\n\r\n  param = params[0];\r\n  if (param < 1) param = 1;\r\n  row = this.y + this.ybase;\r\n\r\n  j = this.rows - 1 - this.scrollBottom;\r\n  j = this.rows - 1 + this.ybase - j + 1;\r\n\r\n  while (param--) {\r\n    // test: echo -e '\\e[44m\\e[1L\\e[0m'\r\n    // blankLine(true) - xterm/linux behavior\r\n    this.lines.splice(row, 0, this.blankLine(true));\r\n    this.lines.splice(j, 1);\r\n  }\r\n\r\n  // this.maxRange();\r\n  this.updateRange(this.y);\r\n  this.updateRange(this.scrollBottom);\r\n};\r\n\r\n\r\n/**\r\n * CSI Ps M\r\n * Delete Ps Line(s) (default = 1) (DL).\r\n */\r\nTerminal.prototype.deleteLines = function(params) {\r\n  var param, row, j;\r\n\r\n  param = params[0];\r\n  if (param < 1) param = 1;\r\n  row = this.y + this.ybase;\r\n\r\n  j = this.rows - 1 - this.scrollBottom;\r\n  j = this.rows - 1 + this.ybase - j;\r\n\r\n  while (param--) {\r\n    // test: echo -e '\\e[44m\\e[1M\\e[0m'\r\n    // blankLine(true) - xterm/linux behavior\r\n    this.lines.splice(j + 1, 0, this.blankLine(true));\r\n    this.lines.splice(row, 1);\r\n  }\r\n\r\n  // this.maxRange();\r\n  this.updateRange(this.y);\r\n  this.updateRange(this.scrollBottom);\r\n};\r\n\r\n\r\n/**\r\n * CSI Ps P\r\n * Delete Ps Character(s) (default = 1) (DCH).\r\n */\r\nTerminal.prototype.deleteChars = function(params) {\r\n  var param, row, ch;\r\n\r\n  param = params[0];\r\n  if (param < 1) param = 1;\r\n\r\n  row = this.y + this.ybase;\r\n  ch = [this.eraseAttr(), ' ', 1]; // xterm\r\n\r\n  while (param--) {\r\n    this.lines[row].splice(this.x, 1);\r\n    this.lines[row].push(ch);\r\n  }\r\n};\r\n\r\n/**\r\n * CSI Ps X\r\n * Erase Ps Character(s) (default = 1) (ECH).\r\n */\r\nTerminal.prototype.eraseChars = function(params) {\r\n  var param, row, j, ch;\r\n\r\n  param = params[0];\r\n  if (param < 1) param = 1;\r\n\r\n  row = this.y + this.ybase;\r\n  j = this.x;\r\n  ch = [this.eraseAttr(), ' ', 1]; // xterm\r\n\r\n  while (param-- && j < this.cols) {\r\n    this.lines[row][j++] = ch;\r\n  }\r\n};\r\n\r\n/**\r\n * CSI Pm `  Character Position Absolute\r\n *   [column] (default = [row,1]) (HPA).\r\n */\r\nTerminal.prototype.charPosAbsolute = function(params) {\r\n  var param = params[0];\r\n  if (param < 1) param = 1;\r\n  this.x = param - 1;\r\n  if (this.x >= this.cols) {\r\n    this.x = this.cols - 1;\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * 141 61 a * HPR -\r\n * Horizontal Position Relative\r\n * reuse CSI Ps C ?\r\n */\r\nTerminal.prototype.HPositionRelative = function(params) {\r\n  var param = params[0];\r\n  if (param < 1) param = 1;\r\n  this.x += param;\r\n  if (this.x >= this.cols) {\r\n    this.x = this.cols - 1;\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * CSI Ps c  Send Device Attributes (Primary DA).\r\n *     Ps = 0  or omitted -> request attributes from terminal.  The\r\n *     response depends on the decTerminalID resource setting.\r\n *     -> CSI ? 1 ; 2 c  (``VT100 with Advanced Video Option'')\r\n *     -> CSI ? 1 ; 0 c  (``VT101 with No Options'')\r\n *     -> CSI ? 6 c  (``VT102'')\r\n *     -> CSI ? 6 0 ; 1 ; 2 ; 6 ; 8 ; 9 ; 1 5 ; c  (``VT220'')\r\n *   The VT100-style response parameters do not mean anything by\r\n *   themselves.  VT220 parameters do, telling the host what fea-\r\n *   tures the terminal supports:\r\n *     Ps = 1  -> 132-columns.\r\n *     Ps = 2  -> Printer.\r\n *     Ps = 6  -> Selective erase.\r\n *     Ps = 8  -> User-defined keys.\r\n *     Ps = 9  -> National replacement character sets.\r\n *     Ps = 1 5  -> Technical characters.\r\n *     Ps = 2 2  -> ANSI color, e.g., VT525.\r\n *     Ps = 2 9  -> ANSI text locator (i.e., DEC Locator mode).\r\n * CSI > Ps c\r\n *   Send Device Attributes (Secondary DA).\r\n *     Ps = 0  or omitted -> request the terminal's identification\r\n *     code.  The response depends on the decTerminalID resource set-\r\n *     ting.  It should apply only to VT220 and up, but xterm extends\r\n *     this to VT100.\r\n *     -> CSI  > Pp ; Pv ; Pc c\r\n *   where Pp denotes the terminal type\r\n *     Pp = 0  -> ``VT100''.\r\n *     Pp = 1  -> ``VT220''.\r\n *   and Pv is the firmware version (for xterm, this was originally\r\n *   the XFree86 patch number, starting with 95).  In a DEC termi-\r\n *   nal, Pc indicates the ROM cartridge registration number and is\r\n *   always zero.\r\n * More information:\r\n *   xterm/charproc.c - line 2012, for more information.\r\n *   vim responds with ^[[?0c or ^[[?1c after the terminal's response (?)\r\n */\r\nTerminal.prototype.sendDeviceAttributes = function(params) {\r\n  if (params[0] > 0) return;\r\n\r\n  if (!this.prefix) {\r\n    if (this.is('xterm')\r\n        || this.is('rxvt-unicode')\r\n        || this.is('screen')) {\r\n      this.send('\\x1b[?1;2c');\r\n    } else if (this.is('linux')) {\r\n      this.send('\\x1b[?6c');\r\n    }\r\n  } else if (this.prefix === '>') {\r\n    // xterm and urxvt\r\n    // seem to spit this\r\n    // out around ~370 times (?).\r\n    if (this.is('xterm')) {\r\n      this.send('\\x1b[>0;276;0c');\r\n    } else if (this.is('rxvt-unicode')) {\r\n      this.send('\\x1b[>85;95;0c');\r\n    } else if (this.is('linux')) {\r\n      // not supported by linux console.\r\n      // linux console echoes parameters.\r\n      this.send(params[0] + 'c');\r\n    } else if (this.is('screen')) {\r\n      this.send('\\x1b[>83;40003;0c');\r\n    }\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * CSI Pm d\r\n * Line Position Absolute  [row] (default = [1,column]) (VPA).\r\n */\r\nTerminal.prototype.linePosAbsolute = function(params) {\r\n  var param = params[0];\r\n  if (param < 1) param = 1;\r\n  this.y = param - 1;\r\n  if (this.y >= this.rows) {\r\n    this.y = this.rows - 1;\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * 145 65 e * VPR - Vertical Position Relative\r\n * reuse CSI Ps B ?\r\n */\r\nTerminal.prototype.VPositionRelative = function(params) {\r\n  var param = params[0];\r\n  if (param < 1) param = 1;\r\n  this.y += param;\r\n  if (this.y >= this.rows) {\r\n    this.y = this.rows - 1;\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * CSI Ps ; Ps f\r\n *   Horizontal and Vertical Position [row;column] (default =\r\n *   [1,1]) (HVP).\r\n */\r\nTerminal.prototype.HVPosition = function(params) {\r\n  if (params[0] < 1) params[0] = 1;\r\n  if (params[1] < 1) params[1] = 1;\r\n\r\n  this.y = params[0] - 1;\r\n  if (this.y >= this.rows) {\r\n    this.y = this.rows - 1;\r\n  }\r\n\r\n  this.x = params[1] - 1;\r\n  if (this.x >= this.cols) {\r\n    this.x = this.cols - 1;\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * CSI Pm h  Set Mode (SM).\r\n *     Ps = 2  -> Keyboard Action Mode (AM).\r\n *     Ps = 4  -> Insert Mode (IRM).\r\n *     Ps = 1 2  -> Send/receive (SRM).\r\n *     Ps = 2 0  -> Automatic Newline (LNM).\r\n * CSI ? Pm h\r\n *   DEC Private Mode Set (DECSET).\r\n *     Ps = 1  -> Application Cursor Keys (DECCKM).\r\n *     Ps = 2  -> Designate USASCII for character sets G0-G3\r\n *     (DECANM), and set VT100 mode.\r\n *     Ps = 3  -> 132 Column Mode (DECCOLM).\r\n *     Ps = 4  -> Smooth (Slow) Scroll (DECSCLM).\r\n *     Ps = 5  -> Reverse Video (DECSCNM).\r\n *     Ps = 6  -> Origin Mode (DECOM).\r\n *     Ps = 7  -> Wraparound Mode (DECAWM).\r\n *     Ps = 8  -> Auto-repeat Keys (DECARM).\r\n *     Ps = 9  -> Send Mouse X & Y on button press.  See the sec-\r\n *     tion Mouse Tracking.\r\n *     Ps = 1 0  -> Show toolbar (rxvt).\r\n *     Ps = 1 2  -> Start Blinking Cursor (att610).\r\n *     Ps = 1 8  -> Print form feed (DECPFF).\r\n *     Ps = 1 9  -> Set print extent to full screen (DECPEX).\r\n *     Ps = 2 5  -> Show Cursor (DECTCEM).\r\n *     Ps = 3 0  -> Show scrollbar (rxvt).\r\n *     Ps = 3 5  -> Enable font-shifting functions (rxvt).\r\n *     Ps = 3 8  -> Enter Tektronix Mode (DECTEK).\r\n *     Ps = 4 0  -> Allow 80 -> 132 Mode.\r\n *     Ps = 4 1  -> more(1) fix (see curses resource).\r\n *     Ps = 4 2  -> Enable Nation Replacement Character sets (DECN-\r\n *     RCM).\r\n *     Ps = 4 4  -> Turn On Margin Bell.\r\n *     Ps = 4 5  -> Reverse-wraparound Mode.\r\n *     Ps = 4 6  -> Start Logging.  This is normally disabled by a\r\n *     compile-time option.\r\n *     Ps = 4 7  -> Use Alternate Screen Buffer.  (This may be dis-\r\n *     abled by the titeInhibit resource).\r\n *     Ps = 6 6  -> Application keypad (DECNKM).\r\n *     Ps = 6 7  -> Backarrow key sends backspace (DECBKM).\r\n *     Ps = 1 0 0 0  -> Send Mouse X & Y on button press and\r\n *     release.  See the section Mouse Tracking.\r\n *     Ps = 1 0 0 1  -> Use Hilite Mouse Tracking.\r\n *     Ps = 1 0 0 2  -> Use Cell Motion Mouse Tracking.\r\n *     Ps = 1 0 0 3  -> Use All Motion Mouse Tracking.\r\n *     Ps = 1 0 0 4  -> Send FocusIn/FocusOut events.\r\n *     Ps = 1 0 0 5  -> Enable Extended Mouse Mode.\r\n *     Ps = 1 0 1 0  -> Scroll to bottom on tty output (rxvt).\r\n *     Ps = 1 0 1 1  -> Scroll to bottom on key press (rxvt).\r\n *     Ps = 1 0 3 4  -> Interpret \"meta\" key, sets eighth bit.\r\n *     (enables the eightBitInput resource).\r\n *     Ps = 1 0 3 5  -> Enable special modifiers for Alt and Num-\r\n *     Lock keys.  (This enables the numLock resource).\r\n *     Ps = 1 0 3 6  -> Send ESC   when Meta modifies a key.  (This\r\n *     enables the metaSendsEscape resource).\r\n *     Ps = 1 0 3 7  -> Send DEL from the editing-keypad Delete\r\n *     key.\r\n *     Ps = 1 0 3 9  -> Send ESC  when Alt modifies a key.  (This\r\n *     enables the altSendsEscape resource).\r\n *     Ps = 1 0 4 0  -> Keep selection even if not highlighted.\r\n *     (This enables the keepSelection resource).\r\n *     Ps = 1 0 4 1  -> Use the CLIPBOARD selection.  (This enables\r\n *     the selectToClipboard resource).\r\n *     Ps = 1 0 4 2  -> Enable Urgency window manager hint when\r\n *     Control-G is received.  (This enables the bellIsUrgent\r\n *     resource).\r\n *     Ps = 1 0 4 3  -> Enable raising of the window when Control-G\r\n *     is received.  (enables the popOnBell resource).\r\n *     Ps = 1 0 4 7  -> Use Alternate Screen Buffer.  (This may be\r\n *     disabled by the titeInhibit resource).\r\n *     Ps = 1 0 4 8  -> Save cursor as in DECSC.  (This may be dis-\r\n *     abled by the titeInhibit resource).\r\n *     Ps = 1 0 4 9  -> Save cursor as in DECSC and use Alternate\r\n *     Screen Buffer, clearing it first.  (This may be disabled by\r\n *     the titeInhibit resource).  This combines the effects of the 1\r\n *     0 4 7  and 1 0 4 8  modes.  Use this with terminfo-based\r\n *     applications rather than the 4 7  mode.\r\n *     Ps = 1 0 5 0  -> Set terminfo/termcap function-key mode.\r\n *     Ps = 1 0 5 1  -> Set Sun function-key mode.\r\n *     Ps = 1 0 5 2  -> Set HP function-key mode.\r\n *     Ps = 1 0 5 3  -> Set SCO function-key mode.\r\n *     Ps = 1 0 6 0  -> Set legacy keyboard emulation (X11R6).\r\n *     Ps = 1 0 6 1  -> Set VT220 keyboard emulation.\r\n *     Ps = 2 0 0 4  -> Set bracketed paste mode.\r\n * Modes:\r\n *   http: *vt100.net/docs/vt220-rm/chapter4.html\r\n */\r\nTerminal.prototype.setMode = function(params) {\r\n  if (typeof params === 'object') {\r\n    var l = params.length\r\n    , i = 0;\r\n\r\n    for (; i < l; i++) {\r\n      this.setMode(params[i]);\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  if (!this.prefix) {\r\n    switch (params) {\r\n      case 4:\r\n        this.insertMode = true;\r\n        break;\r\n      case 20:\r\n        //this.convertEol = true;\r\n        break;\r\n    }\r\n  } else if (this.prefix === '?') {\r\n    switch (params) {\r\n      case 1:\r\n        this.applicationCursor = true;\r\n        break;\r\n      case 2:\r\n        this.setgCharset(0, Terminal.charsets.US);\r\n        this.setgCharset(1, Terminal.charsets.US);\r\n        this.setgCharset(2, Terminal.charsets.US);\r\n        this.setgCharset(3, Terminal.charsets.US);\r\n        // set VT100 mode here\r\n        break;\r\n      case 3: // 132 col mode\r\n        this.savedCols = this.cols;\r\n        this.resize(132, this.rows);\r\n        break;\r\n      case 6:\r\n        this.originMode = true;\r\n        break;\r\n      case 7:\r\n        this.wraparoundMode = true;\r\n        break;\r\n      case 12:\r\n        // this.cursorBlink = true;\r\n        break;\r\n      case 66:\r\n        this.log('Serial port requested application keypad.');\r\n        this.applicationKeypad = true;\r\n        this.viewport.setApplicationMode(true);\r\n        break;\r\n      case 9: // X10 Mouse\r\n        // no release, no motion, no wheel, no modifiers.\r\n      case 1000: // vt200 mouse\r\n        // no motion.\r\n        // no modifiers, except control on the wheel.\r\n      case 1002: // button event mouse\r\n      case 1003: // any event mouse\r\n        // any event - sends motion events,\r\n        // even if there is no button held down.\r\n        this.x10Mouse = params === 9;\r\n        this.vt200Mouse = params === 1000;\r\n        this.normalMouse = params > 1000;\r\n        this.mouseEvents = true;\r\n        this.element.style.cursor = 'default';\r\n        this.log('Binding to mouse events.');\r\n        break;\r\n      case 1004: // send focusin/focusout events\r\n        // focusin: ^[[I\r\n        // focusout: ^[[O\r\n        this.sendFocus = true;\r\n        break;\r\n      case 1005: // utf8 ext mode mouse\r\n        this.utfMouse = true;\r\n        // for wide terminals\r\n        // simply encodes large values as utf8 characters\r\n        break;\r\n      case 1006: // sgr ext mode mouse\r\n        this.sgrMouse = true;\r\n        // for wide terminals\r\n        // does not add 32 to fields\r\n        // press: ^[[<b;x;yM\r\n        // release: ^[[<b;x;ym\r\n        break;\r\n      case 1015: // urxvt ext mode mouse\r\n        this.urxvtMouse = true;\r\n        // for wide terminals\r\n        // numbers for fields\r\n        // press: ^[[b;x;yM\r\n        // motion: ^[[b;x;yT\r\n        break;\r\n      case 25: // show cursor\r\n        this.cursorHidden = false;\r\n        break;\r\n      case 1049: // alt screen buffer cursor\r\n        //this.saveCursor();\r\n        ; // FALL-THROUGH\r\n      case 47: // alt screen buffer\r\n      case 1047: // alt screen buffer\r\n        if (!this.normal) {\r\n          var normal = {\r\n            lines: this.lines,\r\n            ybase: this.ybase,\r\n            ydisp: this.ydisp,\r\n            x: this.x,\r\n            y: this.y,\r\n            scrollTop: this.scrollTop,\r\n            scrollBottom: this.scrollBottom,\r\n            tabs: this.tabs\r\n            // XXX save charset(s) here?\r\n            // charset: this.charset,\r\n            // glevel: this.glevel,\r\n            // charsets: this.charsets\r\n          };\r\n          this.reset();\r\n          this.normal = normal;\r\n          this.showCursor();\r\n        }\r\n        break;\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * CSI Pm l  Reset Mode (RM).\r\n *     Ps = 2  -> Keyboard Action Mode (AM).\r\n *     Ps = 4  -> Replace Mode (IRM).\r\n *     Ps = 1 2  -> Send/receive (SRM).\r\n *     Ps = 2 0  -> Normal Linefeed (LNM).\r\n * CSI ? Pm l\r\n *   DEC Private Mode Reset (DECRST).\r\n *     Ps = 1  -> Normal Cursor Keys (DECCKM).\r\n *     Ps = 2  -> Designate VT52 mode (DECANM).\r\n *     Ps = 3  -> 80 Column Mode (DECCOLM).\r\n *     Ps = 4  -> Jump (Fast) Scroll (DECSCLM).\r\n *     Ps = 5  -> Normal Video (DECSCNM).\r\n *     Ps = 6  -> Normal Cursor Mode (DECOM).\r\n *     Ps = 7  -> No Wraparound Mode (DECAWM).\r\n *     Ps = 8  -> No Auto-repeat Keys (DECARM).\r\n *     Ps = 9  -> Don't send Mouse X & Y on button press.\r\n *     Ps = 1 0  -> Hide toolbar (rxvt).\r\n *     Ps = 1 2  -> Stop Blinking Cursor (att610).\r\n *     Ps = 1 8  -> Don't print form feed (DECPFF).\r\n *     Ps = 1 9  -> Limit print to scrolling region (DECPEX).\r\n *     Ps = 2 5  -> Hide Cursor (DECTCEM).\r\n *     Ps = 3 0  -> Don't show scrollbar (rxvt).\r\n *     Ps = 3 5  -> Disable font-shifting functions (rxvt).\r\n *     Ps = 4 0  -> Disallow 80 -> 132 Mode.\r\n *     Ps = 4 1  -> No more(1) fix (see curses resource).\r\n *     Ps = 4 2  -> Disable Nation Replacement Character sets (DEC-\r\n *     NRCM).\r\n *     Ps = 4 4  -> Turn Off Margin Bell.\r\n *     Ps = 4 5  -> No Reverse-wraparound Mode.\r\n *     Ps = 4 6  -> Stop Logging.  (This is normally disabled by a\r\n *     compile-time option).\r\n *     Ps = 4 7  -> Use Normal Screen Buffer.\r\n *     Ps = 6 6  -> Numeric keypad (DECNKM).\r\n *     Ps = 6 7  -> Backarrow key sends delete (DECBKM).\r\n *     Ps = 1 0 0 0  -> Don't send Mouse X & Y on button press and\r\n *     release.  See the section Mouse Tracking.\r\n *     Ps = 1 0 0 1  -> Don't use Hilite Mouse Tracking.\r\n *     Ps = 1 0 0 2  -> Don't use Cell Motion Mouse Tracking.\r\n *     Ps = 1 0 0 3  -> Don't use All Motion Mouse Tracking.\r\n *     Ps = 1 0 0 4  -> Don't send FocusIn/FocusOut events.\r\n *     Ps = 1 0 0 5  -> Disable Extended Mouse Mode.\r\n *     Ps = 1 0 1 0  -> Don't scroll to bottom on tty output\r\n *     (rxvt).\r\n *     Ps = 1 0 1 1  -> Don't scroll to bottom on key press (rxvt).\r\n *     Ps = 1 0 3 4  -> Don't interpret \"meta\" key.  (This disables\r\n *     the eightBitInput resource).\r\n *     Ps = 1 0 3 5  -> Disable special modifiers for Alt and Num-\r\n *     Lock keys.  (This disables the numLock resource).\r\n *     Ps = 1 0 3 6  -> Don't send ESC  when Meta modifies a key.\r\n *     (This disables the metaSendsEscape resource).\r\n *     Ps = 1 0 3 7  -> Send VT220 Remove from the editing-keypad\r\n *     Delete key.\r\n *     Ps = 1 0 3 9  -> Don't send ESC  when Alt modifies a key.\r\n *     (This disables the altSendsEscape resource).\r\n *     Ps = 1 0 4 0  -> Do not keep selection when not highlighted.\r\n *     (This disables the keepSelection resource).\r\n *     Ps = 1 0 4 1  -> Use the PRIMARY selection.  (This disables\r\n *     the selectToClipboard resource).\r\n *     Ps = 1 0 4 2  -> Disable Urgency window manager hint when\r\n *     Control-G is received.  (This disables the bellIsUrgent\r\n *     resource).\r\n *     Ps = 1 0 4 3  -> Disable raising of the window when Control-\r\n *     G is received.  (This disables the popOnBell resource).\r\n *     Ps = 1 0 4 7  -> Use Normal Screen Buffer, clearing screen\r\n *     first if in the Alternate Screen.  (This may be disabled by\r\n *     the titeInhibit resource).\r\n *     Ps = 1 0 4 8  -> Restore cursor as in DECRC.  (This may be\r\n *     disabled by the titeInhibit resource).\r\n *     Ps = 1 0 4 9  -> Use Normal Screen Buffer and restore cursor\r\n *     as in DECRC.  (This may be disabled by the titeInhibit\r\n *     resource).  This combines the effects of the 1 0 4 7  and 1 0\r\n *     4 8  modes.  Use this with terminfo-based applications rather\r\n *     than the 4 7  mode.\r\n *     Ps = 1 0 5 0  -> Reset terminfo/termcap function-key mode.\r\n *     Ps = 1 0 5 1  -> Reset Sun function-key mode.\r\n *     Ps = 1 0 5 2  -> Reset HP function-key mode.\r\n *     Ps = 1 0 5 3  -> Reset SCO function-key mode.\r\n *     Ps = 1 0 6 0  -> Reset legacy keyboard emulation (X11R6).\r\n *     Ps = 1 0 6 1  -> Reset keyboard emulation to Sun/PC style.\r\n *     Ps = 2 0 0 4  -> Reset bracketed paste mode.\r\n */\r\nTerminal.prototype.resetMode = function(params) {\r\n  if (typeof params === 'object') {\r\n    var l = params.length\r\n    , i = 0;\r\n\r\n    for (; i < l; i++) {\r\n      this.resetMode(params[i]);\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  if (!this.prefix) {\r\n    switch (params) {\r\n      case 4:\r\n        this.insertMode = false;\r\n        break;\r\n      case 20:\r\n        //this.convertEol = false;\r\n        break;\r\n    }\r\n  } else if (this.prefix === '?') {\r\n    switch (params) {\r\n      case 1:\r\n        this.applicationCursor = false;\r\n        break;\r\n      case 3:\r\n        if (this.cols === 132 && this.savedCols) {\r\n          this.resize(this.savedCols, this.rows);\r\n        }\r\n        delete this.savedCols;\r\n        break;\r\n      case 6:\r\n        this.originMode = false;\r\n        break;\r\n      case 7:\r\n        this.wraparoundMode = false;\r\n        break;\r\n      case 12:\r\n        // this.cursorBlink = false;\r\n        break;\r\n      case 66:\r\n        this.log('Switching back to normal keypad.');\r\n        this.applicationKeypad = false;\r\n        this.viewport.setApplicationMode(false);\r\n        break;\r\n      case 9: // X10 Mouse\r\n      case 1000: // vt200 mouse\r\n      case 1002: // button event mouse\r\n      case 1003: // any event mouse\r\n        this.x10Mouse = false;\r\n        this.vt200Mouse = false;\r\n        this.normalMouse = false;\r\n        this.mouseEvents = false;\r\n        this.element.style.cursor = '';\r\n        break;\r\n      case 1004: // send focusin/focusout events\r\n        this.sendFocus = false;\r\n        break;\r\n      case 1005: // utf8 ext mode mouse\r\n        this.utfMouse = false;\r\n        break;\r\n      case 1006: // sgr ext mode mouse\r\n        this.sgrMouse = false;\r\n        break;\r\n      case 1015: // urxvt ext mode mouse\r\n        this.urxvtMouse = false;\r\n        break;\r\n      case 25: // hide cursor\r\n        this.cursorHidden = true;\r\n        break;\r\n      case 1049: // alt screen buffer cursor\r\n        ; // FALL-THROUGH\r\n      case 47: // normal screen buffer\r\n      case 1047: // normal screen buffer - clearing it first\r\n        if (this.normal) {\r\n          this.lines = this.normal.lines;\r\n          this.ybase = this.normal.ybase;\r\n          this.ydisp = this.normal.ydisp;\r\n          this.x = this.normal.x;\r\n          this.y = this.normal.y;\r\n          this.scrollTop = this.normal.scrollTop;\r\n          this.scrollBottom = this.normal.scrollBottom;\r\n          this.tabs = this.normal.tabs;\r\n          this.normal = null;\r\n          // if (params === 1049) {\r\n          //   this.x = this.savedX;\r\n          //   this.y = this.savedY;\r\n          // }\r\n          this.refresh(0, this.rows - 1);\r\n          this.showCursor();\r\n        }\r\n        break;\r\n    }\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * CSI Ps ; Ps r\r\n *   Set Scrolling Region [top;bottom] (default = full size of win-\r\n *   dow) (DECSTBM).\r\n * CSI ? Pm r\r\n */\r\nTerminal.prototype.setScrollRegion = function(params) {\r\n  if (this.prefix) return;\r\n  this.scrollTop = (params[0] || 1) - 1;\r\n  this.scrollBottom = (params[1] || this.rows) - 1;\r\n  this.x = 0;\r\n  this.y = 0;\r\n};\r\n\r\n\r\n/**\r\n * CSI s\r\n *   Save cursor (ANSI.SYS).\r\n */\r\nTerminal.prototype.saveCursor = function(params) {\r\n  this.savedX = this.x;\r\n  this.savedY = this.y;\r\n};\r\n\r\n\r\n/**\r\n * CSI u\r\n *   Restore cursor (ANSI.SYS).\r\n */\r\nTerminal.prototype.restoreCursor = function(params) {\r\n  this.x = this.savedX || 0;\r\n  this.y = this.savedY || 0;\r\n};\r\n\r\n\r\n/**\r\n * Lesser Used\r\n */\r\n\r\n/**\r\n * CSI Ps I\r\n *   Cursor Forward Tabulation Ps tab stops (default = 1) (CHT).\r\n */\r\nTerminal.prototype.cursorForwardTab = function(params) {\r\n  var param = params[0] || 1;\r\n  while (param--) {\r\n    this.x = this.nextStop();\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * CSI Ps S  Scroll up Ps lines (default = 1) (SU).\r\n */\r\nTerminal.prototype.scrollUp = function(params) {\r\n  var param = params[0] || 1;\r\n  while (param--) {\r\n    this.lines.splice(this.ybase + this.scrollTop, 1);\r\n    this.lines.splice(this.ybase + this.scrollBottom, 0, this.blankLine());\r\n  }\r\n  // this.maxRange();\r\n  this.updateRange(this.scrollTop);\r\n  this.updateRange(this.scrollBottom);\r\n};\r\n\r\n\r\n/**\r\n     * CSI Ps T  Scroll down Ps lines (default = 1) (SD).\r\n     */\r\nTerminal.prototype.scrollDown = function(params) {\r\n  var param = params[0] || 1;\r\n  while (param--) {\r\n    this.lines.splice(this.ybase + this.scrollBottom, 1);\r\n    this.lines.splice(this.ybase + this.scrollTop, 0, this.blankLine());\r\n  }\r\n  // this.maxRange();\r\n  this.updateRange(this.scrollTop);\r\n  this.updateRange(this.scrollBottom);\r\n};\r\n\r\n\r\n/**\r\n * CSI Ps ; Ps ; Ps ; Ps ; Ps T\r\n *   Initiate highlight mouse tracking.  Parameters are\r\n *   [func;startx;starty;firstrow;lastrow].  See the section Mouse\r\n *   Tracking.\r\n */\r\nTerminal.prototype.initMouseTracking = function(params) {\r\n  // Relevant: DECSET 1001\r\n};\r\n\r\n\r\n/**\r\n * CSI > Ps; Ps T\r\n *   Reset one or more features of the title modes to the default\r\n *   value.  Normally, \"reset\" disables the feature.  It is possi-\r\n *   ble to disable the ability to reset features by compiling a\r\n *   different default for the title modes into xterm.\r\n *     Ps = 0  -> Do not set window/icon labels using hexadecimal.\r\n *     Ps = 1  -> Do not query window/icon labels using hexadeci-\r\n *     mal.\r\n *     Ps = 2  -> Do not set window/icon labels using UTF-8.\r\n *     Ps = 3  -> Do not query window/icon labels using UTF-8.\r\n *   (See discussion of \"Title Modes\").\r\n */\r\nTerminal.prototype.resetTitleModes = function(params) {\r\n  ;\r\n};\r\n\r\n\r\n/**\r\n * CSI Ps Z  Cursor Backward Tabulation Ps tab stops (default = 1) (CBT).\r\n */\r\nTerminal.prototype.cursorBackwardTab = function(params) {\r\n  var param = params[0] || 1;\r\n  while (param--) {\r\n    this.x = this.prevStop();\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * CSI Ps b  Repeat the preceding graphic character Ps times (REP).\r\n */\r\nTerminal.prototype.repeatPrecedingCharacter = function(params) {\r\n  var param = params[0] || 1\r\n  , line = this.lines[this.ybase + this.y]\r\n  , ch = line[this.x - 1] || [this.defAttr, ' ', 1];\r\n\r\n  while (param--) line[this.x++] = ch;\r\n};\r\n\r\n\r\n/**\r\n * CSI Ps g  Tab Clear (TBC).\r\n *     Ps = 0  -> Clear Current Column (default).\r\n *     Ps = 3  -> Clear All.\r\n * Potentially:\r\n *   Ps = 2  -> Clear Stops on Line.\r\n *   http://vt100.net/annarbor/aaa-ug/section6.html\r\n */\r\nTerminal.prototype.tabClear = function(params) {\r\n  var param = params[0];\r\n  if (param <= 0) {\r\n    delete this.tabs[this.x];\r\n  } else if (param === 3) {\r\n    this.tabs = {};\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * CSI Pm i  Media Copy (MC).\r\n *     Ps = 0  -> Print screen (default).\r\n *     Ps = 4  -> Turn off printer controller mode.\r\n *     Ps = 5  -> Turn on printer controller mode.\r\n * CSI ? Pm i\r\n *   Media Copy (MC, DEC-specific).\r\n *     Ps = 1  -> Print line containing cursor.\r\n *     Ps = 4  -> Turn off autoprint mode.\r\n *     Ps = 5  -> Turn on autoprint mode.\r\n *     Ps = 1  0  -> Print composed display, ignores DECPEX.\r\n *     Ps = 1  1  -> Print all pages.\r\n */\r\nTerminal.prototype.mediaCopy = function(params) {\r\n  ;\r\n};\r\n\r\n\r\n/**\r\n * CSI > Ps; Ps m\r\n *   Set or reset resource-values used by xterm to decide whether\r\n *   to construct escape sequences holding information about the\r\n *   modifiers pressed with a given key.  The first parameter iden-\r\n *   tifies the resource to set/reset.  The second parameter is the\r\n *   value to assign to the resource.  If the second parameter is\r\n *   omitted, the resource is reset to its initial value.\r\n *     Ps = 1  -> modifyCursorKeys.\r\n *     Ps = 2  -> modifyFunctionKeys.\r\n *     Ps = 4  -> modifyOtherKeys.\r\n *   If no parameters are given, all resources are reset to their\r\n *   initial values.\r\n */\r\nTerminal.prototype.setResources = function(params) {\r\n  ;\r\n};\r\n\r\n\r\n/**\r\n * CSI > Ps n\r\n *   Disable modifiers which may be enabled via the CSI > Ps; Ps m\r\n *   sequence.  This corresponds to a resource value of \"-1\", which\r\n *   cannot be set with the other sequence.  The parameter identi-\r\n *   fies the resource to be disabled:\r\n *     Ps = 1  -> modifyCursorKeys.\r\n *     Ps = 2  -> modifyFunctionKeys.\r\n *     Ps = 4  -> modifyOtherKeys.\r\n *   If the parameter is omitted, modifyFunctionKeys is disabled.\r\n *   When modifyFunctionKeys is disabled, xterm uses the modifier\r\n *   keys to make an extended sequence of functions rather than\r\n *   adding a parameter to each function key to denote the modi-\r\n *   fiers.\r\n */\r\nTerminal.prototype.disableModifiers = function(params) {\r\n  ;\r\n};\r\n\r\n\r\n/**\r\n * CSI > Ps p\r\n *   Set resource value pointerMode.  This is used by xterm to\r\n *   decide whether to hide the pointer cursor as the user types.\r\n *   Valid values for the parameter:\r\n *     Ps = 0  -> never hide the pointer.\r\n *     Ps = 1  -> hide if the mouse tracking mode is not enabled.\r\n *     Ps = 2  -> always hide the pointer.  If no parameter is\r\n *     given, xterm uses the default, which is 1 .\r\n */\r\nTerminal.prototype.setPointerMode = function(params) {\r\n  ;\r\n};\r\n\r\n\r\n/**\r\n * CSI ! p   Soft terminal reset (DECSTR).\r\n * http://vt100.net/docs/vt220-rm/table4-10.html\r\n */\r\nTerminal.prototype.softReset = function(params) {\r\n  this.cursorHidden = false;\r\n  this.insertMode = false;\r\n  this.originMode = false;\r\n  this.wraparoundMode = false; // autowrap\r\n  this.applicationKeypad = false; // ?\r\n  this.viewport.setApplicationMode(false);\r\n  this.applicationCursor = false;\r\n  this.scrollTop = 0;\r\n  this.scrollBottom = this.rows - 1;\r\n  this.curAttr = this.defAttr;\r\n  this.x = this.y = 0; // ?\r\n  this.charset = null;\r\n  this.glevel = 0; // ??\r\n  this.charsets = [null]; // ??\r\n};\r\n\r\n\r\n/**\r\n * CSI Ps$ p\r\n *   Request ANSI mode (DECRQM).  For VT300 and up, reply is\r\n *     CSI Ps; Pm$ y\r\n *   where Ps is the mode number as in RM, and Pm is the mode\r\n *   value:\r\n *     0 - not recognized\r\n *     1 - set\r\n *     2 - reset\r\n *     3 - permanently set\r\n *     4 - permanently reset\r\n */\r\nTerminal.prototype.requestAnsiMode = function(params) {\r\n  ;\r\n};\r\n\r\n\r\n/**\r\n * CSI ? Ps$ p\r\n *   Request DEC private mode (DECRQM).  For VT300 and up, reply is\r\n *     CSI ? Ps; Pm$ p\r\n *   where Ps is the mode number as in DECSET, Pm is the mode value\r\n *   as in the ANSI DECRQM.\r\n */\r\nTerminal.prototype.requestPrivateMode = function(params) {\r\n  ;\r\n};\r\n\r\n\r\n/**\r\n * CSI Ps ; Ps \" p\r\n *   Set conformance level (DECSCL).  Valid values for the first\r\n *   parameter:\r\n *     Ps = 6 1  -> VT100.\r\n *     Ps = 6 2  -> VT200.\r\n *     Ps = 6 3  -> VT300.\r\n *   Valid values for the second parameter:\r\n *     Ps = 0  -> 8-bit controls.\r\n *     Ps = 1  -> 7-bit controls (always set for VT100).\r\n *     Ps = 2  -> 8-bit controls.\r\n */\r\nTerminal.prototype.setConformanceLevel = function(params) {\r\n  ;\r\n};\r\n\r\n\r\n/**\r\n * CSI Ps q  Load LEDs (DECLL).\r\n *     Ps = 0  -> Clear all LEDS (default).\r\n *     Ps = 1  -> Light Num Lock.\r\n *     Ps = 2  -> Light Caps Lock.\r\n *     Ps = 3  -> Light Scroll Lock.\r\n *     Ps = 2  1  -> Extinguish Num Lock.\r\n *     Ps = 2  2  -> Extinguish Caps Lock.\r\n *     Ps = 2  3  -> Extinguish Scroll Lock.\r\n */\r\nTerminal.prototype.loadLEDs = function(params) {\r\n  ;\r\n};\r\n\r\n\r\n/**\r\n * CSI Ps SP q\r\n *   Set cursor style (DECSCUSR, VT520).\r\n *     Ps = 0  -> blinking block.\r\n *     Ps = 1  -> blinking block (default).\r\n *     Ps = 2  -> steady block.\r\n *     Ps = 3  -> blinking underline.\r\n *     Ps = 4  -> steady underline.\r\n */\r\nTerminal.prototype.setCursorStyle = function(params) {\r\n  ;\r\n};\r\n\r\n\r\n/**\r\n * CSI Ps \" q\r\n *   Select character protection attribute (DECSCA).  Valid values\r\n *   for the parameter:\r\n *     Ps = 0  -> DECSED and DECSEL can erase (default).\r\n *     Ps = 1  -> DECSED and DECSEL cannot erase.\r\n *     Ps = 2  -> DECSED and DECSEL can erase.\r\n */\r\nTerminal.prototype.setCharProtectionAttr = function(params) {\r\n  ;\r\n};\r\n\r\n\r\n/**\r\n * CSI ? Pm r\r\n *   Restore DEC Private Mode Values.  The value of Ps previously\r\n *   saved is restored.  Ps values are the same as for DECSET.\r\n */\r\nTerminal.prototype.restorePrivateValues = function(params) {\r\n  ;\r\n};\r\n\r\n\r\n/**\r\n * CSI Pt; Pl; Pb; Pr; Ps$ r\r\n *   Change Attributes in Rectangular Area (DECCARA), VT400 and up.\r\n *     Pt; Pl; Pb; Pr denotes the rectangle.\r\n *     Ps denotes the SGR attributes to change: 0, 1, 4, 5, 7.\r\n * NOTE: xterm doesn't enable this code by default.\r\n */\r\nTerminal.prototype.setAttrInRectangle = function(params) {\r\n  var t = params[0]\r\n  , l = params[1]\r\n  , b = params[2]\r\n  , r = params[3]\r\n  , attr = params[4];\r\n\r\n  var line\r\n  , i;\r\n\r\n  for (; t < b + 1; t++) {\r\n    line = this.lines[this.ybase + t];\r\n    for (i = l; i < r; i++) {\r\n      line[i] = [attr, line[i][1]];\r\n    }\r\n  }\r\n\r\n  // this.maxRange();\r\n  this.updateRange(params[0]);\r\n  this.updateRange(params[2]);\r\n};\r\n\r\n\r\n/**\r\n * CSI Pc; Pt; Pl; Pb; Pr$ x\r\n *   Fill Rectangular Area (DECFRA), VT420 and up.\r\n *     Pc is the character to use.\r\n *     Pt; Pl; Pb; Pr denotes the rectangle.\r\n * NOTE: xterm doesn't enable this code by default.\r\n */\r\nTerminal.prototype.fillRectangle = function(params) {\r\n  var ch = params[0]\r\n  , t = params[1]\r\n  , l = params[2]\r\n  , b = params[3]\r\n  , r = params[4];\r\n\r\n  var line\r\n  , i;\r\n\r\n  for (; t < b + 1; t++) {\r\n    line = this.lines[this.ybase + t];\r\n    for (i = l; i < r; i++) {\r\n      line[i] = [line[i][0], String.fromCharCode(ch)];\r\n    }\r\n  }\r\n\r\n  // this.maxRange();\r\n  this.updateRange(params[1]);\r\n  this.updateRange(params[3]);\r\n};\r\n\r\n\r\n/**\r\n * CSI Ps ; Pu ' z\r\n *   Enable Locator Reporting (DECELR).\r\n *   Valid values for the first parameter:\r\n *     Ps = 0  -> Locator disabled (default).\r\n *     Ps = 1  -> Locator enabled.\r\n *     Ps = 2  -> Locator enabled for one report, then disabled.\r\n *   The second parameter specifies the coordinate unit for locator\r\n *   reports.\r\n *   Valid values for the second parameter:\r\n *     Pu = 0  <- or omitted -> default to character cells.\r\n *     Pu = 1  <- device physical pixels.\r\n *     Pu = 2  <- character cells.\r\n */\r\nTerminal.prototype.enableLocatorReporting = function(params) {\r\n  var val = params[0] > 0;\r\n  //this.mouseEvents = val;\r\n  //this.decLocator = val;\r\n};\r\n\r\n\r\n/**\r\n * CSI Pt; Pl; Pb; Pr$ z\r\n *   Erase Rectangular Area (DECERA), VT400 and up.\r\n *     Pt; Pl; Pb; Pr denotes the rectangle.\r\n * NOTE: xterm doesn't enable this code by default.\r\n */\r\nTerminal.prototype.eraseRectangle = function(params) {\r\n  var t = params[0]\r\n  , l = params[1]\r\n  , b = params[2]\r\n  , r = params[3];\r\n\r\n  var line\r\n  , i\r\n  , ch;\r\n\r\n  ch = [this.eraseAttr(), ' ', 1]; // xterm?\r\n\r\n  for (; t < b + 1; t++) {\r\n    line = this.lines[this.ybase + t];\r\n    for (i = l; i < r; i++) {\r\n      line[i] = ch;\r\n    }\r\n  }\r\n\r\n  // this.maxRange();\r\n  this.updateRange(params[0]);\r\n  this.updateRange(params[2]);\r\n};\r\n\r\n\r\n/**\r\n * CSI P m SP }\r\n * Insert P s Column(s) (default = 1) (DECIC), VT420 and up.\r\n * NOTE: xterm doesn't enable this code by default.\r\n */\r\nTerminal.prototype.insertColumns = function() {\r\n  var param = params[0]\r\n  , l = this.ybase + this.rows\r\n  , ch = [this.eraseAttr(), ' ', 1] // xterm?\r\n  , i;\r\n\r\n  while (param--) {\r\n    for (i = this.ybase; i < l; i++) {\r\n      this.lines[i].splice(this.x + 1, 0, ch);\r\n      this.lines[i].pop();\r\n    }\r\n  }\r\n\r\n  this.maxRange();\r\n};\r\n\r\n\r\n/**\r\n * CSI P m SP ~\r\n * Delete P s Column(s) (default = 1) (DECDC), VT420 and up\r\n * NOTE: xterm doesn't enable this code by default.\r\n */\r\nTerminal.prototype.deleteColumns = function() {\r\n  var param = params[0]\r\n  , l = this.ybase + this.rows\r\n  , ch = [this.eraseAttr(), ' ', 1] // xterm?\r\n  , i;\r\n\r\n  while (param--) {\r\n    for (i = this.ybase; i < l; i++) {\r\n      this.lines[i].splice(this.x, 1);\r\n      this.lines[i].push(ch);\r\n    }\r\n  }\r\n\r\n  this.maxRange();\r\n};\r\n\r\n/**\r\n * Character Sets\r\n */\r\n\r\nTerminal.charsets = {};\r\n\r\n// DEC Special Character and Line Drawing Set.\r\n// http://vt100.net/docs/vt102-ug/table5-13.html\r\n// A lot of curses apps use this if they see TERM=xterm.\r\n// testing: echo -e '\\e(0a\\e(B'\r\n// The xterm output sometimes seems to conflict with the\r\n// reference above. xterm seems in line with the reference\r\n// when running vttest however.\r\n// The table below now uses xterm's output from vttest.\r\nTerminal.charsets.SCLD = { // (0\r\n  '`': '\\u25c6', // ''\r\n  'a': '\\u2592', // ''\r\n  'b': '\\u0009', // '\\t'\r\n  'c': '\\u000c', // '\\f'\r\n  'd': '\\u000d', // '\\r'\r\n  'e': '\\u000a', // '\\n'\r\n  'f': '\\u00b0', // ''\r\n  'g': '\\u00b1', // ''\r\n  'h': '\\u2424', // '\\u2424' (NL)\r\n  'i': '\\u000b', // '\\v'\r\n  'j': '\\u2518', // ''\r\n  'k': '\\u2510', // ''\r\n  'l': '\\u250c', // ''\r\n  'm': '\\u2514', // ''\r\n  'n': '\\u253c', // ''\r\n  'o': '\\u23ba', // ''\r\n  'p': '\\u23bb', // ''\r\n  'q': '\\u2500', // ''\r\n  'r': '\\u23bc', // ''\r\n  's': '\\u23bd', // ''\r\n  't': '\\u251c', // ''\r\n  'u': '\\u2524', // ''\r\n  'v': '\\u2534', // ''\r\n  'w': '\\u252c', // ''\r\n  'x': '\\u2502', // ''\r\n  'y': '\\u2264', // ''\r\n  'z': '\\u2265', // ''\r\n  '{': '\\u03c0', // ''\r\n  '|': '\\u2260', // ''\r\n  '}': '\\u00a3', // ''\r\n  '~': '\\u00b7'  // ''\r\n};\r\n\r\nTerminal.charsets.UK = null; // (A\r\nTerminal.charsets.US = null; // (B (USASCII)\r\nTerminal.charsets.Dutch = null; // (4\r\nTerminal.charsets.Finnish = null; // (C or (5\r\nTerminal.charsets.French = null; // (R\r\nTerminal.charsets.FrenchCanadian = null; // (Q\r\nTerminal.charsets.German = null; // (K\r\nTerminal.charsets.Italian = null; // (Y\r\nTerminal.charsets.NorwegianDanish = null; // (E or (6\r\nTerminal.charsets.Spanish = null; // (Z\r\nTerminal.charsets.Swedish = null; // (H or (7\r\nTerminal.charsets.Swiss = null; // (=\r\nTerminal.charsets.ISOLatin = null; // /A\r\n\r\n/**\r\n * Helpers\r\n */\r\n\r\nfunction contains(el, arr) {\r\n  for (var i = 0; i < arr.length; i += 1) {\r\n    if (el === arr[i]) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction on(el, type, handler, capture) {\r\n  if (!Array.isArray(el)) {\r\n    el = [el];\r\n  }\r\n  el.forEach(function (element) {\r\n    element.addEventListener(type, handler, capture || false);\r\n  });\r\n}\r\n\r\nfunction off(el, type, handler, capture) {\r\n  el.removeEventListener(type, handler, capture || false);\r\n}\r\n\r\nfunction cancel(ev, force) {\r\n  if (!this.cancelEvents && !force) {\r\n    return;\r\n  }\r\n  ev.preventDefault();\r\n  ev.stopPropagation();\r\n  return false;\r\n}\r\n\r\nfunction inherits(child, parent) {\r\n  function f() {\r\n    this.constructor = child;\r\n  }\r\n  f.prototype = parent.prototype;\r\n  child.prototype = new f;\r\n}\r\n\r\n// if bold is broken, we can't\r\n// use it in the terminal.\r\nfunction isBoldBroken(document) {\r\n  var body = document.getElementsByTagName('body')[0];\r\n  var el = document.createElement('span');\r\n  el.innerHTML = 'hello world';\r\n  body.appendChild(el);\r\n  var w1 = el.scrollWidth;\r\n  el.style.fontWeight = 'bold';\r\n  var w2 = el.scrollWidth;\r\n  body.removeChild(el);\r\n  return w1 !== w2;\r\n}\r\n\r\nfunction indexOf(obj, el) {\r\n  var i = obj.length;\r\n  while (i--) {\r\n    if (obj[i] === el) return i;\r\n  }\r\n  return -1;\r\n}\r\n\r\nfunction isThirdLevelShift(term, ev) {\r\n  var thirdLevelKey =\r\n      (term.isMac && ev.altKey && !ev.ctrlKey && !ev.metaKey) ||\r\n      (term.isMSWindows && ev.altKey && ev.ctrlKey && !ev.metaKey);\r\n\r\n  if (ev.type == 'keypress') {\r\n    return thirdLevelKey;\r\n  }\r\n\r\n  // Don't invoke for arrows, pageDown, home, backspace, etc. (on non-keypress events)\r\n  return thirdLevelKey && (!ev.keyCode || ev.keyCode > 47);\r\n}\r\n\r\nfunction matchColor(r1, g1, b1) {\r\n  var hash = (r1 << 16) | (g1 << 8) | b1;\r\n\r\n  if (matchColor._cache[hash] != null) {\r\n    return matchColor._cache[hash];\r\n  }\r\n\r\n  var ldiff = Infinity\r\n  , li = -1\r\n  , i = 0\r\n  , c\r\n  , r2\r\n  , g2\r\n  , b2\r\n  , diff;\r\n\r\n  for (; i < Terminal.vcolors.length; i++) {\r\n    c = Terminal.vcolors[i];\r\n    r2 = c[0];\r\n    g2 = c[1];\r\n    b2 = c[2];\r\n\r\n    diff = matchColor.distance(r1, g1, b1, r2, g2, b2);\r\n\r\n    if (diff === 0) {\r\n      li = i;\r\n      break;\r\n    }\r\n\r\n    if (diff < ldiff) {\r\n      ldiff = diff;\r\n      li = i;\r\n    }\r\n  }\r\n\r\n  return matchColor._cache[hash] = li;\r\n}\r\n\r\nmatchColor._cache = {};\r\n\r\n// http://stackoverflow.com/questions/1633828\r\nmatchColor.distance = function(r1, g1, b1, r2, g2, b2) {\r\n  return Math.pow(30 * (r1 - r2), 2)\r\n    + Math.pow(59 * (g1 - g2), 2)\r\n    + Math.pow(11 * (b1 - b2), 2);\r\n};\r\n\r\nfunction each(obj, iter, con) {\r\n  if (obj.forEach) return obj.forEach(iter, con);\r\n  for (var i = 0; i < obj.length; i++) {\r\n    iter.call(con, obj[i], i, obj);\r\n  }\r\n}\r\n\r\nfunction keys(obj) {\r\n  if (Object.keys) return Object.keys(obj);\r\n  var key, keys = [];\r\n  for (key in obj) {\r\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n      keys.push(key);\r\n    }\r\n  }\r\n  return keys;\r\n}\r\n\r\nvar wcwidth = (function(opts) {\r\n  // extracted from https://www.cl.cam.ac.uk/%7Emgk25/ucs/wcwidth.c\r\n  // combining characters\r\n  var COMBINING = [\r\n    [0x0300, 0x036F], [0x0483, 0x0486], [0x0488, 0x0489],\r\n    [0x0591, 0x05BD], [0x05BF, 0x05BF], [0x05C1, 0x05C2],\r\n    [0x05C4, 0x05C5], [0x05C7, 0x05C7], [0x0600, 0x0603],\r\n    [0x0610, 0x0615], [0x064B, 0x065E], [0x0670, 0x0670],\r\n    [0x06D6, 0x06E4], [0x06E7, 0x06E8], [0x06EA, 0x06ED],\r\n    [0x070F, 0x070F], [0x0711, 0x0711], [0x0730, 0x074A],\r\n    [0x07A6, 0x07B0], [0x07EB, 0x07F3], [0x0901, 0x0902],\r\n    [0x093C, 0x093C], [0x0941, 0x0948], [0x094D, 0x094D],\r\n    [0x0951, 0x0954], [0x0962, 0x0963], [0x0981, 0x0981],\r\n    [0x09BC, 0x09BC], [0x09C1, 0x09C4], [0x09CD, 0x09CD],\r\n    [0x09E2, 0x09E3], [0x0A01, 0x0A02], [0x0A3C, 0x0A3C],\r\n    [0x0A41, 0x0A42], [0x0A47, 0x0A48], [0x0A4B, 0x0A4D],\r\n    [0x0A70, 0x0A71], [0x0A81, 0x0A82], [0x0ABC, 0x0ABC],\r\n    [0x0AC1, 0x0AC5], [0x0AC7, 0x0AC8], [0x0ACD, 0x0ACD],\r\n    [0x0AE2, 0x0AE3], [0x0B01, 0x0B01], [0x0B3C, 0x0B3C],\r\n    [0x0B3F, 0x0B3F], [0x0B41, 0x0B43], [0x0B4D, 0x0B4D],\r\n    [0x0B56, 0x0B56], [0x0B82, 0x0B82], [0x0BC0, 0x0BC0],\r\n    [0x0BCD, 0x0BCD], [0x0C3E, 0x0C40], [0x0C46, 0x0C48],\r\n    [0x0C4A, 0x0C4D], [0x0C55, 0x0C56], [0x0CBC, 0x0CBC],\r\n    [0x0CBF, 0x0CBF], [0x0CC6, 0x0CC6], [0x0CCC, 0x0CCD],\r\n    [0x0CE2, 0x0CE3], [0x0D41, 0x0D43], [0x0D4D, 0x0D4D],\r\n    [0x0DCA, 0x0DCA], [0x0DD2, 0x0DD4], [0x0DD6, 0x0DD6],\r\n    [0x0E31, 0x0E31], [0x0E34, 0x0E3A], [0x0E47, 0x0E4E],\r\n    [0x0EB1, 0x0EB1], [0x0EB4, 0x0EB9], [0x0EBB, 0x0EBC],\r\n    [0x0EC8, 0x0ECD], [0x0F18, 0x0F19], [0x0F35, 0x0F35],\r\n    [0x0F37, 0x0F37], [0x0F39, 0x0F39], [0x0F71, 0x0F7E],\r\n    [0x0F80, 0x0F84], [0x0F86, 0x0F87], [0x0F90, 0x0F97],\r\n    [0x0F99, 0x0FBC], [0x0FC6, 0x0FC6], [0x102D, 0x1030],\r\n    [0x1032, 0x1032], [0x1036, 0x1037], [0x1039, 0x1039],\r\n    [0x1058, 0x1059], [0x1160, 0x11FF], [0x135F, 0x135F],\r\n    [0x1712, 0x1714], [0x1732, 0x1734], [0x1752, 0x1753],\r\n    [0x1772, 0x1773], [0x17B4, 0x17B5], [0x17B7, 0x17BD],\r\n    [0x17C6, 0x17C6], [0x17C9, 0x17D3], [0x17DD, 0x17DD],\r\n    [0x180B, 0x180D], [0x18A9, 0x18A9], [0x1920, 0x1922],\r\n    [0x1927, 0x1928], [0x1932, 0x1932], [0x1939, 0x193B],\r\n    [0x1A17, 0x1A18], [0x1B00, 0x1B03], [0x1B34, 0x1B34],\r\n    [0x1B36, 0x1B3A], [0x1B3C, 0x1B3C], [0x1B42, 0x1B42],\r\n    [0x1B6B, 0x1B73], [0x1DC0, 0x1DCA], [0x1DFE, 0x1DFF],\r\n    [0x200B, 0x200F], [0x202A, 0x202E], [0x2060, 0x2063],\r\n    [0x206A, 0x206F], [0x20D0, 0x20EF], [0x302A, 0x302F],\r\n    [0x3099, 0x309A], [0xA806, 0xA806], [0xA80B, 0xA80B],\r\n    [0xA825, 0xA826], [0xFB1E, 0xFB1E], [0xFE00, 0xFE0F],\r\n    [0xFE20, 0xFE23], [0xFEFF, 0xFEFF], [0xFFF9, 0xFFFB],\r\n    [0x10A01, 0x10A03], [0x10A05, 0x10A06], [0x10A0C, 0x10A0F],\r\n    [0x10A38, 0x10A3A], [0x10A3F, 0x10A3F], [0x1D167, 0x1D169],\r\n    [0x1D173, 0x1D182], [0x1D185, 0x1D18B], [0x1D1AA, 0x1D1AD],\r\n    [0x1D242, 0x1D244], [0xE0001, 0xE0001], [0xE0020, 0xE007F],\r\n    [0xE0100, 0xE01EF]\r\n  ];\r\n  // binary search\r\n  function bisearch(ucs) {\r\n    var min = 0;\r\n    var max = COMBINING.length - 1;\r\n    var mid;\r\n    if (ucs < COMBINING[0][0] || ucs > COMBINING[max][1])\r\n      return false;\r\n    while (max >= min) {\r\n      mid = Math.floor((min + max) / 2);\r\n      if (ucs > COMBINING[mid][1])\r\n        min = mid + 1;\r\n      else if (ucs < COMBINING[mid][0])\r\n        max = mid - 1;\r\n      else\r\n        return true;\r\n    }\r\n    return false;\r\n  }\r\n  function wcwidth(ucs) {\r\n    // test for 8-bit control characters\r\n    if (ucs === 0)\r\n      return opts.nul;\r\n    if (ucs < 32 || (ucs >= 0x7f && ucs < 0xa0))\r\n      return opts.control;\r\n    // binary search in table of non-spacing characters\r\n    if (bisearch(ucs))\r\n      return 0;\r\n    // if we arrive here, ucs is not a combining or C0/C1 control character\r\n    return 1 +\r\n      (\r\n      ucs >= 0x1100 &&\r\n      (\r\n        ucs <= 0x115f ||                // Hangul Jamo init. consonants\r\n        ucs == 0x2329 ||\r\n        ucs == 0x232a ||\r\n        (ucs >= 0x2e80 && ucs <= 0xa4cf && ucs != 0x303f) ||  // CJK..Yi\r\n        (ucs >= 0xac00 && ucs <= 0xd7a3) ||    // Hangul Syllables\r\n        (ucs >= 0xf900 && ucs <= 0xfaff) ||    // CJK Compat Ideographs\r\n        (ucs >= 0xfe10 && ucs <= 0xfe19) ||    // Vertical forms\r\n        (ucs >= 0xfe30 && ucs <= 0xfe6f) ||    // CJK Compat Forms\r\n        (ucs >= 0xff00 && ucs <= 0xff60) ||    // Fullwidth Forms\r\n        (ucs >= 0xffe0 && ucs <= 0xffe6) ||\r\n        (ucs >= 0x20000 && ucs <= 0x2fffd) ||\r\n        (ucs >= 0x30000 && ucs <= 0x3fffd)\r\n      )\r\n    );\r\n  }\r\n  return wcwidth;\r\n})({nul: 0, control: 0});  // configurable options\r\n\r\n/**\r\n * Expose\r\n */\r\n\r\nTerminal.EventEmitter = EventEmitter;\r\nTerminal.CompositionHelper = CompositionHelper;\r\nTerminal.Viewport = Viewport;\r\nTerminal.inherits = inherits;\r\n\r\n/**\r\n * Adds an event listener to the terminal.\r\n *\r\n * @param {string} event The name of the event. TODO: Document all event types\r\n * @param {function} callback The function to call when the event is triggered.\r\n */\r\nTerminal.on = on;\r\nTerminal.off = off;\r\nTerminal.cancel = cancel;\r\n\r\nmodule.exports = Terminal;\r\n"
  ]
}